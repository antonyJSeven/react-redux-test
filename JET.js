/*! JET - v2.0.13 - 2016-10-04 *//*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.0.2
 */

(function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function lib$es6$promise$utils$$isFunction(x){return typeof x==="function"}function lib$es6$promise$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var lib$es6$promise$utils$$_isArray;if(!Array.isArray){lib$es6$promise$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{lib$es6$promise$utils$$_isArray=Array.isArray}var lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray;var lib$es6$promise$asap$$len=0;var lib$es6$promise$asap$$toString={}.toString;var lib$es6$promise$asap$$vertxNext;var lib$es6$promise$asap$$customSchedulerFn;var lib$es6$promise$asap$$asap=function asap(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback;lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg;lib$es6$promise$asap$$len+=2;if(lib$es6$promise$asap$$len===2){if(lib$es6$promise$asap$$customSchedulerFn){lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush)}else{lib$es6$promise$asap$$scheduleFlush()}}};function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}var lib$es6$promise$asap$$browserWindow=typeof window!=="undefined"?window:undefined;var lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{};var lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;var lib$es6$promise$asap$$isNode=typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var lib$es6$promise$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0;var observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=lib$es6$promise$asap$$flush;return function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}var lib$es6$promise$asap$$queue=new Array(1e3);function lib$es6$promise$asap$$flush(){for(var i=0;i<lib$es6$promise$asap$$len;i+=2){var callback=lib$es6$promise$asap$$queue[i];var arg=lib$es6$promise$asap$$queue[i+1];callback(arg);lib$es6$promise$asap$$queue[i]=undefined;lib$es6$promise$asap$$queue[i+1]=undefined}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertx(){try{var r=require;var vertx=r("vertx");lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext;return lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}var lib$es6$promise$asap$$scheduleFlush;if(lib$es6$promise$asap$$isNode){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useNextTick()}else if(lib$es6$promise$asap$$BrowserMutationObserver){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMutationObserver()}else if(lib$es6$promise$asap$$isWorker){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMessageChannel()}else if(lib$es6$promise$asap$$browserWindow===undefined&&typeof require==="function"){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$attemptVertx()}else{lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useSetTimeout()}function lib$es6$promise$$internal$$noop(){}var lib$es6$promise$$internal$$PENDING=void 0;var lib$es6$promise$$internal$$FULFILLED=1;var lib$es6$promise$$internal$$REJECTED=2;var lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){lib$es6$promise$$internal$$GET_THEN_ERROR.error=error;return lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=false;var error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){lib$es6$promise$$internal$$resolve(promise,value)}else{lib$es6$promise$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;lib$es6$promise$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;lib$es6$promise$$internal$$reject(promise,error)}},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,thenable._result)}else if(thenable._state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,thenable._result)}else{lib$es6$promise$$internal$$subscribe(thenable,undefined,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor){lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable)}else{var then=lib$es6$promise$$internal$$getThen(maybeThenable);if(then===lib$es6$promise$$internal$$GET_THEN_ERROR){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}else if(lib$es6$promise$utils$$isFunction(then)){lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}}function lib$es6$promise$$internal$$resolve(promise,value){if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment())}else if(lib$es6$promise$utils$$objectOrFunction(value)){lib$es6$promise$$internal$$handleMaybeThenable(promise,value)}else{lib$es6$promise$$internal$$fulfill(promise,value)}}function lib$es6$promise$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._result=value;promise._state=lib$es6$promise$$internal$$FULFILLED;if(promise._subscribers.length!==0){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise)}}function lib$es6$promise$$internal$$reject(promise,reason){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._state=lib$es6$promise$$internal$$REJECTED;promise._result=reason;lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise)}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment;subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}var lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e;return lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=lib$es6$promise$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=lib$es6$promise$$internal$$tryCatch(callback,detail);if(value===lib$es6$promise$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==lib$es6$promise$$internal$$PENDING){}else if(hasCallback&&succeeded){lib$es6$promise$$internal$$resolve(promise,value)}else if(failed){lib$es6$promise$$internal$$reject(promise,error)}else if(settled===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,value)}else if(settled===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){lib$es6$promise$$internal$$resolve(promise,value)},function rejectPromise(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor;enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop);if(enumerator._validateInput(input)){enumerator._input=input;enumerator.length=input.length;enumerator._remaining=input.length;enumerator._init();if(enumerator.length===0){lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result)}else{enumerator.length=enumerator.length||0;enumerator._enumerate();if(enumerator._remaining===0){lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result)}}}else{lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}}lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)};lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){var enumerator=this;var length=enumerator.length;var promise=enumerator.promise;var input=enumerator._input;for(var i=0;promise._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){enumerator._eachEntry(input[i],i)}};lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this;var c=enumerator._instanceConstructor;if(lib$es6$promise$utils$$isMaybeThenable(entry)){if(entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING){entry._onerror=null;enumerator._settledAt(entry._state,i,entry._result)}else{enumerator._willSettleAt(c.resolve(entry),i)}}else{enumerator._remaining--;enumerator._result[i]=entry}};lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this;var promise=enumerator.promise;if(promise._state===lib$es6$promise$$internal$$PENDING){enumerator._remaining--;if(state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}else{enumerator._result[i]=value}}if(enumerator._remaining===0){lib$es6$promise$$internal$$fulfill(promise,enumerator._result)}};lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all;function lib$es6$promise$promise$race$$race(entries){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries)){lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race."));return promise}var length=entries.length;function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}for(var i=0;promise._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),undefined,onFulfillment,onRejection)}return promise}var lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race;function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$resolve(promise,object);return promise}var lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve;function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$reject(promise,reason);return promise}var lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject;var lib$es6$promise$promise$$counter=0;function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++;this._state=undefined;this._result=undefined;this._subscribers=[];if(lib$es6$promise$$internal$$noop!==resolver){if(!lib$es6$promise$utils$$isFunction(resolver)){lib$es6$promise$promise$$needsResolver()}if(!(this instanceof lib$es6$promise$promise$$Promise)){lib$es6$promise$promise$$needsNew()}lib$es6$promise$$internal$$initializePromise(this,resolver)}}lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default;lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default;lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default;lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default;lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler;lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap;lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap;lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this;var state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection){return this}var child=new this.constructor(lib$es6$promise$$internal$$noop);var result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else{lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child},"catch":function(onRejection){return this.then(null,onRejection)}};function lib$es6$promise$polyfill$$polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P&&Object.prototype.toString.call(P.resolve())==="[object Promise]"&&!P.cast){return}local.Promise=lib$es6$promise$promise$$default}var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill;var lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};if(typeof define==="function"&&define["amd"]){define(function(){return lib$es6$promise$umd$$ES6Promise})}else if(typeof module!=="undefined"&&module["exports"]){module["exports"]=lib$es6$promise$umd$$ES6Promise}else if(typeof this!=="undefined"){this["ES6Promise"]=lib$es6$promise$umd$$ES6Promise}lib$es6$promise$polyfill$$default()}).call(this);;(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;(function(){try{cachedSetTimeout=setTimeout}catch(e){cachedSetTimeout=function(){throw new Error("setTimeout is not defined")}}try{cachedClearTimeout=clearTimeout}catch(e){cachedClearTimeout=function(){throw new Error("clearTimeout is not defined")}}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],2:[function(require,module,exports){(function(process,global){(function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function lib$es6$promise$utils$$isFunction(x){return typeof x==="function"}function lib$es6$promise$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var lib$es6$promise$utils$$_isArray;if(!Array.isArray){lib$es6$promise$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{lib$es6$promise$utils$$_isArray=Array.isArray}var lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray;var lib$es6$promise$asap$$len=0;var lib$es6$promise$asap$$vertxNext;var lib$es6$promise$asap$$customSchedulerFn;var lib$es6$promise$asap$$asap=function asap(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback;lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg;lib$es6$promise$asap$$len+=2;if(lib$es6$promise$asap$$len===2){if(lib$es6$promise$asap$$customSchedulerFn){lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush)}else{lib$es6$promise$asap$$scheduleFlush()}}};function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}var lib$es6$promise$asap$$browserWindow=typeof window!=="undefined"?window:undefined;var lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{};var lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;var lib$es6$promise$asap$$isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var lib$es6$promise$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0;var observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=lib$es6$promise$asap$$flush;return function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}var lib$es6$promise$asap$$queue=new Array(1e3);function lib$es6$promise$asap$$flush(){for(var i=0;i<lib$es6$promise$asap$$len;i+=2){var callback=lib$es6$promise$asap$$queue[i];var arg=lib$es6$promise$asap$$queue[i+1];callback(arg);lib$es6$promise$asap$$queue[i]=undefined;lib$es6$promise$asap$$queue[i+1]=undefined}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertx(){try{var r=require;var vertx=r("vertx");lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext;return lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}var lib$es6$promise$asap$$scheduleFlush;if(lib$es6$promise$asap$$isNode){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useNextTick()}else if(lib$es6$promise$asap$$BrowserMutationObserver){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMutationObserver()}else if(lib$es6$promise$asap$$isWorker){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMessageChannel()}else if(lib$es6$promise$asap$$browserWindow===undefined&&typeof require==="function"){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$attemptVertx()}else{lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useSetTimeout()}function lib$es6$promise$then$$then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(lib$es6$promise$$internal$$noop);if(child[lib$es6$promise$$internal$$PROMISE_ID]===undefined){lib$es6$promise$$internal$$makePromise(child)}var state=parent._state;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,parent._result)})}else{lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child}var lib$es6$promise$then$$default=lib$es6$promise$then$$then;function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$resolve(promise,object);return promise}var lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve;var lib$es6$promise$$internal$$PROMISE_ID=Math.random().toString(36).substring(16);function lib$es6$promise$$internal$$noop(){}var lib$es6$promise$$internal$$PENDING=void 0;var lib$es6$promise$$internal$$FULFILLED=1;var lib$es6$promise$$internal$$REJECTED=2;var lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){lib$es6$promise$$internal$$GET_THEN_ERROR.error=error;return lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=false;var error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){lib$es6$promise$$internal$$resolve(promise,value)}else{lib$es6$promise$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;lib$es6$promise$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;lib$es6$promise$$internal$$reject(promise,error)}},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,thenable._result)}else if(thenable._state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,thenable._result)}else{lib$es6$promise$$internal$$subscribe(thenable,undefined,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable,then){if(maybeThenable.constructor===promise.constructor&&then===lib$es6$promise$then$$default&&constructor.resolve===lib$es6$promise$promise$resolve$$default){lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable)}else{if(then===lib$es6$promise$$internal$$GET_THEN_ERROR){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}else if(lib$es6$promise$utils$$isFunction(then)){lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}}function lib$es6$promise$$internal$$resolve(promise,value){if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment())}else if(lib$es6$promise$utils$$objectOrFunction(value)){lib$es6$promise$$internal$$handleMaybeThenable(promise,value,lib$es6$promise$$internal$$getThen(value))}else{lib$es6$promise$$internal$$fulfill(promise,value)}}function lib$es6$promise$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._result=value;promise._state=lib$es6$promise$$internal$$FULFILLED;if(promise._subscribers.length!==0){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise)}}function lib$es6$promise$$internal$$reject(promise,reason){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._state=lib$es6$promise$$internal$$REJECTED;promise._result=reason;lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise)}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment;subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}var lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e;return lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=lib$es6$promise$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=lib$es6$promise$$internal$$tryCatch(callback,detail);if(value===lib$es6$promise$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==lib$es6$promise$$internal$$PENDING){}else if(hasCallback&&succeeded){lib$es6$promise$$internal$$resolve(promise,value)}else if(failed){lib$es6$promise$$internal$$reject(promise,error)}else if(settled===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,value)}else if(settled===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){lib$es6$promise$$internal$$resolve(promise,value)},function rejectPromise(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}var lib$es6$promise$$internal$$id=0;function lib$es6$promise$$internal$$nextId(){return lib$es6$promise$$internal$$id++}function lib$es6$promise$$internal$$makePromise(promise){promise[lib$es6$promise$$internal$$PROMISE_ID]=lib$es6$promise$$internal$$id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all;function lib$es6$promise$promise$race$$race(entries){var Constructor=this;if(!lib$es6$promise$utils$$isArray(entries)){return new Constructor(function(resolve,reject){reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}var lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race;function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$reject(promise,reason);return promise}var lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject;function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;function lib$es6$promise$promise$$Promise(resolver){this[lib$es6$promise$$internal$$PROMISE_ID]=lib$es6$promise$$internal$$nextId();this._result=this._state=undefined;this._subscribers=[];if(lib$es6$promise$$internal$$noop!==resolver){typeof resolver!=="function"&&lib$es6$promise$promise$$needsResolver();this instanceof lib$es6$promise$promise$$Promise?lib$es6$promise$$internal$$initializePromise(this,resolver):lib$es6$promise$promise$$needsNew()}}lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default;lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default;lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default;lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default;lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler;lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap;lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap;lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:lib$es6$promise$then$$default,"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;function lib$es6$promise$enumerator$$Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(lib$es6$promise$$internal$$noop);if(!this.promise[lib$es6$promise$$internal$$PROMISE_ID]){lib$es6$promise$$internal$$makePromise(this.promise)}if(lib$es6$promise$utils$$isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}}}else{lib$es6$promise$$internal$$reject(this.promise,lib$es6$promise$enumerator$$validationError())}}function lib$es6$promise$enumerator$$validationError(){return new Error("Array Methods must be provided an Array")}lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){var length=this.length;var input=this._input;for(var i=0;this._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){this._eachEntry(input[i],i)}};lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve=c.resolve;if(resolve===lib$es6$promise$promise$resolve$$default){var then=lib$es6$promise$$internal$$getThen(entry);if(then===lib$es6$promise$then$$default&&entry._state!==lib$es6$promise$$internal$$PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof then!=="function"){this._remaining--;this._result[i]=entry}else if(c===lib$es6$promise$promise$$default){var promise=new c(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$handleMaybeThenable(promise,entry,then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve){resolve(entry)}),i)}}else{this._willSettleAt(resolve(entry),i)}};lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===lib$es6$promise$$internal$$PENDING){this._remaining--;if(state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){lib$es6$promise$$internal$$fulfill(promise,this._result)}};lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};function lib$es6$promise$polyfill$$polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P&&Object.prototype.toString.call(P.resolve())==="[object Promise]"&&!P.cast){return}local.Promise=lib$es6$promise$promise$$default}var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill;var lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};if(typeof define==="function"&&define["amd"]){define(function(){return lib$es6$promise$umd$$ES6Promise})}else if(typeof module!=="undefined"&&module["exports"]){module["exports"]=lib$es6$promise$umd$$ES6Promise}else if(typeof this!=="undefined"){this["ES6Promise"]=lib$es6$promise$umd$$ES6Promise}lib$es6$promise$polyfill$$default()}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:1}],3:[function(require,module,exports){module.exports={name:"jet-app-containershim",version:"1.1.18",description:"Handles messaging & subscriptions to EikonJET.",scripts:{test:"nyc --reporter=html babel-node spec/babel_spec_runner.js","test:bundle":"browserify spec/spec/specs.js -o spec/browser/test.bundle.js -t [ babelify --presets [ es2015 ] ]",build:"npm run dev && npm run prod",dev:"browserify src/main.js > dist/acs.js",prod:"browserify src/main.js | uglifyjs > dist/acs.min.js",clean:"rimraf dist/*"},repository:{type:"git",url:"git+https://github.com/thomsonreuters/jet-app-containershim.git"},bugs:{url:"https://github.com/thomsonreuters/jet-app-containershim/issues"},homepage:"https://github.com/thomsonreuters/jet-app-containershim#readme",devDependencies:{"babel-cli":"6.11.4","babel-plugin-istanbul":"1.0.3","babel-preset-es2015":"6.9.0",babelify:"7.3.0","es6-promise":"3.2.1",istanbul:"0.4.4",jasmine:"2.4.1",jsdom:"8.2.0",mversion:"1.10.1",nyc:"8.1.0",rimraf:"2.5.2",sinon:"1.17.5",uglifyjs:"2.4.10",xmldom:"0.1.22"},nyc:{exclude:["spec/setup.js","spec/babel_spec_runner.js","spec/mocks/**/*.js","spec/spec/*spec.js"],sourceMap:false,instrument:false}}},{}],4:[function(require,module,exports){var version=require("../package.json").version;var DesktopXML=require("./DesktopXML");var LogMixin=require("./Logger");var windowEvents=require("./windowEvents");var AppContainerThinMixin=require("./AppContainerThin");var BoundObjects=require("./boundObjects");var boundObjects;var frameManager;var unsubscribeAndUnload;var bus=void 0;var registered=false;var _instanceId="unknown"+Math.random()*500;var _appId=null;var isWeb=false;var eikonNow;var aWindow;var frameId=1;function AppContainerShim(options){options=options||{};isWeb=options.isWeb||false;eikonNow=options.eikonNow;frameManager=options.frameManager;aWindow=options.aWindow;this.frames={};this.version=version;this.eventMap={};this.jetToMap={onLog:{},onLoad:{},onPropertyChange:{},onNavigate:{},onContextChange:{},onUnload:{},Session:{},onSaveToStore:{},persistdata:{}};this.jetFromMap={onContextChange:{},onPropertyChange:{},Description:{},UserInfo:{},ContainerInformation:{},fromTransferData:{}};LogMixin(this,frameManager.isDesktop());this.init(options)}AppContainerShim.prototype={getIdsOnChannel:function(channel){if(channel)return this.eventMap[channel];return void 0},addIdToChannel:function(id,channel){if(id&&channel){var connectedRouters=this.getIdsOnChannel(channel);if(connectedRouters)return connectedRouters.push(id);else return this.eventMap[channel]=[id]}},setTopACSRegistered:function(){registered=true;this.__registering=false},init:function(){var ctx=this;this._bindDesktopXML(DesktopXML(aWindow));boundObjects=BoundObjects();try{if(!unsubscribeAndUnload){unsubscribeAndUnload=function(){ctx.unsubscribeAll();ctx._unload()};windowEvents.addEvent(aWindow.top,"unload",unsubscribeAndUnload)}}catch(e){windowEvents.addEvent(aWindow,"unload",function(){ctx.unsubscribeAll();ctx._unload()})}},setBus:function(aBus){bus=aBus},findContainer:function(w){function checkForDesktop(w){try{return(w.registerWithCCFContainer||w.registerWithAsyncCCFContainer||w.registerWithJET||w.eikonLinkReady)&&typeof(w.registerWithCCFContainer||w.registerWithAsyncCCFContainer||w.registerWithJET||w.eikonLinkReady)==="function"}catch(ex){return false}}return checkForDesktop(w)?w:w.parent&&w.parent!==w?this.findContainer(w.parent):window},_registerJETApp:function(JETAppData){var context=this;var params={jet_data:JETAppData};var dfd={};var promise=new Promise(function(resolve,reject){dfd.resolve=resolve;dfd.reject=reject});var options;if(!eikonNow||eikonNow&&!eikonNow.isEnabled()){try{var registerWithJET=aWindow.top.registerWithJET}catch(e){}JETAppData.xmlData=this._toContainer("Session",JETAppData.xmlData).xmlData;if(registerWithJET){var tw=this.findContainer(aWindow);tw.onCEFChannel=function(data){try{context._eikonJET=aWindow.top.EikonJET}catch(e){}context._initJETApp(data).then(function(containerDescription){params.containerDescription=containerDescription;if(context.loggingSource)context.loggingSource("JET_APP_CONTAINER");context.getPersistedJETData().then(function(persistedData){params._topLevel=true;params.persistData=persistedData;try{_instanceId=params.containerDescription.windowInfo.windowId}catch(e){context.debug("no windowId, stability may suffer");_instanceId=null}try{var appInfo=JSON.parse(params.containerDescription.properties[1].AppInfo);_appId=appInfo.AppId}catch(e){context.debug("no appId");_appId=null}context._eikonJET.onMessage(context._onProcessEvent.bind(context));context._eikonJET.onRequest(context._onGetData.bind(context));context.debug("_registerJETApp: ",params);dfd.resolve(params)},function(reject){dfd.reject(reject)})})};var initializeData=JSON.stringify(JETAppData).replace(/\\/g,"\\\\\\");registerWithJET(initializeData);this.setTopACSRegistered(true)}else{dfd.reject("could not find registerWithJET function")}}else if(eikonNow&&eikonNow.isEnabled()){options={JETAppData:JETAppData,dfd:dfd};AppContainerThinMixin.call(context,options);this.setTopACSRegistered(true)}else{dfd.reject("could not register with JET (no registerWithJETCall and no EikonWeb)")}return promise},_initJETApp:function(data){var context=this;var containerDescription=this._fromContainerData("Description",data);if(containerDescription){if(!this._eikonJET){var plugin;plugin=document.createElement("embed");plugin.type="application/x-jetPlugin";plugin.width=0;plugin.height=0;plugin.id="jetPlugin";plugin.style.position="absolute";plugin.style.opacity="0";document.body.appendChild(plugin);this._eikonJET=plugin.jetPlugin()}else{this._eikonJET.init(containerDescription.plugin.channel);this.debug("App Container registered with EikonJET!")}}return new Promise(function(resolve,reject){if(containerDescription)resolve(containerDescription);else reject("could not get container description.")})},getPersistedJETData:function(){var context=this;return new Promise(function(resolve,reject){context.getData({name:"persistdata",xmlData:null,async:function(persist){resolve(persist)}})})},_bindDesktopXML:function(DesktopXML){this.jetFromMap=DesktopXML.fromMap;this.jetToMap=DesktopXML.toMap},_fromContainer:function(event,data){var jetFromMap=this.jetFromMap;var ev=data?{name:event,data:data}:event;return{name:ev.name,data:jetFromMap[ev.name]&&jetFromMap[ev.name].format?jetFromMap[ev.name].format(ev.data||ev.xmlData):ev.data||ev.xmlData,channel:ev.channel}},_fromContainerData:function(event,data){return this._fromContainer(event,data).data},_fromContainerAsync:function(event,data,resolve){var context=this;return new Promise(function(resolve,reject){resolve(context._fromContainer(event,data))})},_toContainer:function(event,data){var jetToMap=this.jetToMap;var ev=data?{name:event,data:data}:event;return{name:ev.name,xmlData:jetToMap[ev.name]&&jetToMap[ev.name].format?jetToMap[ev.name].format(ev.data):ev.data,channel:ev.channel,target:ev.target||"",pipe:ev.pipe||false,instanceId:ev.instance||""}},_toContainerAsync:function(event,data){var context=this;return new Promise(function(resolve,reject){resolve(context._toContainer(event,data))})},_publish:function(publish){publish=publish||{};this.debug("_publish: "+JSON.stringify(publish));this._processEvent(void 0,{name:"Publish",data:publish.data,channel:publish.channel})},_publishWithPipeTarget:function(publish){publish=publish||{};this.debug("_publishWithPipeTarget: ",+JSON.stringify(publish));var data={name:"Publish",data:publish.data,channel:publish.channel,target:publish.target,pipe:publish.pipe||false};if(publish.target){try{var newData={};newData=JSON.stringify({targetData:data.data,targetId:publish.target});data.data=newData}catch(e){}}this._processEvent(void 0,data)},_send:function(send){send=send||{};this._processEvent(void 0,{name:"Publish",data:send.data,channel:send.channel,target:send.target,pipe:true})},_registerFrame:function(source){var frameWindow=source;var frameId=makeFrameId();return this._setFrame(frameId,frameWindow)},_getFrame:function(source){var keys=Object.keys(this.frames);var numKeys=keys.length;var frame=void 0;for(var i=0;i<numKeys;i++){if(source===this.frames[keys[i]].window){frame=this.frames[keys[i]];break}}return frame},_setFrame:function(frameId,frameWindow){this.frames[frameId]={id:frameId,window:frameWindow};return this.frames[frameId]},_removeFrame:function(frameId){delete this.frames[frameId];return this},_mapEventToFrame:function(frameId,channel){if(channel){var connectedRouters=this.getIdsOnChannel(channel);if(!connectedRouters)connectedRouters=this.addIdToChannel(frameId,channel);else{var alreadyInConnected=false;var numberConnected=connectedRouters.length;for(var i=0;i<numberConnected;i++){var id=connectedRouters[i];if(frameId===id){alreadyInConnected=true;break}}if(!alreadyInConnected)connectedRouters.push(frameId)}}return connectedRouters},_subscribeWithPipe:function(source,subscription){var frame=this._getOrRegisterSource(source);var subscriptions=this._mapEventToFrame(frame.id,subscription.channel);this._emitSubscribeWithPipe(subscriptions,subscription)},_emitSubscribeWithPipe:function(subscriptions,subscription){if(subscriptions){if(!subscriptions.isProcessed){var vent={name:"Subscribe",channel:subscription.channel,pipe:true};this._processEvent(void 0,vent);subscriptions.isProcessed=true}}},_subscribeWithPipeTarget:function(source,subscription){var frame=this._getOrRegisterSource(source);var subscriptions=this._mapEventToFrame(frame.id,subscription.channel);this._emitSubscribeWithPipeTarget(subscriptions,subscription)},_emitSubscribeWithPipeTarget:function(subscriptions,subscription){if(subscriptions){if(!subscriptions.isProcessed){var vent={name:"Subscribe",channel:subscription.channel,target:subscription.target,pipe:true};this._processEvent(void 0,vent);if(subscription.requestSubscribeWithPipe){var pipedata=subscription.requestSubscribeWithPipe;var pubData={channel:subscription.channel,target:subscription.target,data:subscription.data};this._processEvent(void 0,{name:"Publish",data:JSON.stringify(pubData),target:subscription.target,channel:pipedata.channel,pipe:true})}subscriptions.isProcessed=true}}},_subscribe:function(source,subscription){this.debug("_subscribe: "+JSON.stringify(subscription));var frame=this._getOrRegisterSource(source);var channel=subscription.channel;var subscriptions=this._mapEventToFrame(frame.id,channel);this._emitSubscribe(subscriptions,channel)},_emitSubscribe:function(subscriptions,channel){if(subscriptions){if(!subscriptions.isProcessed){var vent={name:"Subscribe",data:"",channel:channel};this._processEvent(void 0,vent);subscriptions.isProcessed=true}}},_unsubscribe:function(source,event){var frame=this._getFrame(source);if(frame){var channel=event.channel;var subscribedFrames=this.getIdsOnChannel(channel);if(subscribedFrames){var index=subscribedFrames.indexOf(frame.id);if(index>=0)subscribedFrames.splice(index,1);this._emitUnsubscribe(event)}}},_emitUnsubscribe:function(event){var channel=event.channel;if(this.getIdsOnChannel(channel).length===0){this._processEvent(void 0,event);delete this.eventMap[channel]}},_wrapAsync:function(msg){if(msg&&msg.async){var oldAsync=msg.async;var context=this;msg.async=function(res){oldAsync(res?context._fromContainer(msg.name,res):res);

}}},_processEvent:function(source,msg){this._wrapAsync(msg);msg=this._toContainer(msg);if(_stringStartsWith(msg.target,"!")){if(msg.xmlData){try{var data=JSON.parse(msg.xmlData);data.instanceId=_instanceId;data.appId=_appId;msg.xmlData=JSON.stringify(data)}catch(e){}}}if(msg.name==="onUnload"){this.setTopACSRegistered(false);if(source){var frame=this._getFrame(source);if(frame)this._removeFrame(frame.id)}}msg=JSON.stringify({name:msg.name,data:msg.xmlData,method:"processEvent",channel:msg.channel,pipe:msg.pipe||false});this._eikonJET.post(msg)},_onProcessEvent:function(event){var targetApp;this.debug("_onProcessEvent: "+JSON.stringify(event));if(typeof event==="string")event=JSON.parse(event);event=this._fromContainer(event);try{var data=JSON.parse(event.data);var target=data.target;var targetId=data.targetId;if(target||targetId){if(targetId){if(targetId===_instanceId||_stringStartsWith(targetId,"!")){event.data=data.targetData;this._sendProcessEventMessage(event)}else{return}}else{if(_stringStartsWith(target,"!")){targetApp=data.instanceId;if(targetApp===_instanceId||_stringStartsWith(target,"!")){this._sendProcessEventMessage(event)}else{return}}else{return}}}else{return}}catch(e){}this._sendProcessEventMessage(event)},_sendProcessEventMessage:function(event){var ids=this.getIdsOnChannel(event.channel);var context=this;if(ids){ids.forEach(function(id){var destination=context.frames[id].window;bus.sendMessage(destination,{parseKey:"jet:msg",params:[event],funcName:"doEvent"})})}else if(event.channel===""){var frames=this.frames;var keys=Object.keys(frames);var numKeys=keys.length;for(var i=0;i<numKeys;i++){var frame=frames[keys[i]];bus.sendMessage(frame.window,{parseKey:"jet:msg",params:[event],funcName:"doEvent"})}}else{try{if(isWeb){bus.sendMessage(aWindow,{funcName:"doEvent",params:[event]})}else if(aWindow.top.frames.length){var top=aWindow.top;var length=top.frames.length;for(var i=0;i<length;i++){var currentFrame=top.frames[i];var keys=Object.keys(this.frames);var numberRegisteredFrames=keys.length;var knownFrame=false;for(var j=0;j<numberRegisteredFrames;j++){if(currentFrame===this.frames[keys[j]].window){knownFrame=true;break}}if(!knownFrame){if(currentFrame.JET&&currentFrame.JET.callEventHandler){try{currentFrame.JET.callEventHandler(event)}catch(e){}}}}}}catch(ex){}}},_onProcessEventWithSource:function(source,event){var event=this._fromContainer(event);bus.sendMessage(source,{parseKey:"jet:msg",params:[event],funcName:"doEvent"})},getData:function(r){var context=this;return new Promise(function(resolve,reject){context._wrapAsync(r);var res;var msg=JSON.stringify({name:r.name,data:r.xmlData,method:"getData"});try{res=context._eikonJET.send(msg)}catch(e){reject(e)}if(r.async){r.async(res)}if(res)res=context._fromContainerData(r.name,res);resolve(res)})},_onGetData:function(r){if(typeof r==="string"){r=JSON.parse(r)}if(!r.name){return null}var h=boundObjects.dataProviders[r.name];if(h!=null){var r=h.call(this,r.xmlData);return this._toContainer(r.name,r).xmlData}else return null},_setLoggingLevel:function(level){this.setLogOptions(level)},_setBoundedProp:function(prop){var boundObject=boundObjects[prop.name];if(boundObject&&boundObject.hasOwnProperty(prop.key))boundObject[prop.key]=prop.value},_getBoundedProp:function(name,key){return boundObjects[name][key]},_getOrRegisterSource:function(frame){var source=this._getFrame(frame);if(!source)source=this._registerFrame(frame);return source},_unload:function(){var context=this;this.getPersistedJETData().then(function(data){context._processEvent(void 0,{data:data,name:"onUnload"})})},unRegister:function(){if(registered){this.unsubscribeAll();this._unload();if(typeof bus!=="undefined"&&bus.removeListener)bus.removeListener();registered=false}},unsubscribeAll:function(){var channels=Object.keys(this.eventMap);var numberOfChannels=channels.length;for(var i=0;i<numberOfChannels;i++){var channel=channels[i];this._processEvent(void 0,{name:"Unsubscribe",data:"",channel:channel})}this.eventMap={}}};function makeFrameId(){return frameId++}function _stringStartsWith(string,prefix){if(String.prototype.startsWith){return string.startsWith(prefix)}else{return string.slice(0,prefix.length)===prefix}}module.exports=AppContainerShim},{"../package.json":3,"./AppContainerThin":6,"./DesktopXML":7,"./Logger":8,"./boundObjects":11,"./windowEvents":14}],5:[function(require,module,exports){var called=0;var aWindow;var eikonNow;var frameManager;var MessageManager;var ACS;var _top;function initACS(resolve,reject){if(!resolve||!reject)throw new Error("AppContainerShim needs a resolve & reject to load");else{if(!called){called++;_load(resolve,reject)}else{setTimeout(function(){_load(resolve,reject)},50)}}}function unRegisterACS(){if(_top.__ACS__){called=0;_top.__ACS__.unRegister();frameManager.setOnFrame("__initACS__",undefined,true);frameManager.setOnFrame("__unRegisterACS__",undefined,true)}}function _load(resolve,reject){var results={};if(called===1){called++;results={register:true};createACSMessageManager()}resolve(results)}function createACSMessageManager(){var ACSBus;var isWeb=!frameManager.isDesktop();_top.__ACS__=new ACS({isWeb:isWeb,frameManager:frameManager,aWindow:aWindow,eikonNow:eikonNow});ACSBus=new MessageManager(_top,{sameWindowStrategy:isWeb,frameManager:frameManager});_top.__ACS__.setBus(ACSBus);ACSBus.addStringToParser("jet:msg");ACSBus.registerNamespace(_top.__ACS__)}module.exports=function(options){ACS=options.ACS;eikonNow=options.eikonNow;aWindow=options.aWindow;MessageManager=options.MessageManager;frameManager=options.frameManager;_top=frameManager.getFrame();frameManager.setOnFrame("__initACS__",initACS);frameManager.setOnFrame("__unRegisterACS__",unRegisterACS)}},{}],6:[function(require,module,exports){var ARCHIVE_RESPONSE_CHANNEL="/navigation/archive_response";var ARCHIVE_REQUEST_CHANNEL="/navigation/archive_request";var container;var CCFId=void 0;var resolved_data={};var JETAppData;var _persist;var acs;var registrationDfd;module.exports=function(options){options=options||{};JETAppData=options.JETAppData||"";registrationDfd=options.dfd;var self=acs=this;container=registerWithCCFContainer({getData:self._onGetData,processEvent:processEvent.bind(self)},JETAppData.xmlData);CCFId=container.$$id;resolved_data._topLevel=true;resolved_data.Initialized=container!==null;resolved_data.ContainerType="Sync";this.getData=getData;this._processEvent=function(src,e){if(src&&src instanceof Window){var msg=self._toContainer(e);container.processEvent(msg)}else if(src&&e===void 0){var msg=self._toContainer(src);container.processEvent(msg)}else{var msg=self._toContainer(e);container.processEvent(msg)}};var data=container.getData({name:"description",xmlData:""});if(data!==null){resolved_data.containerDescription=this._fromContainerData("Description",data)}resolved_data.GUID=getGUID(container);container.processEvent({name:"Subscribe",data:"",channel:ARCHIVE_RESPONSE_CHANNEL});container.processEvent(this._toContainer({name:"Publish",data:JSON.stringify({id:JETAppData.ID,url:window.location.href}),channel:ARCHIVE_REQUEST_CHANNEL}))};function getGUID(container){var info=container.getData({name:"ContainerInformation",xmlData:null})||{};return info.GUID}function setPersistData(xmlData){_persist=this._toContainer("persistdata",xmlData.persist).xmlData}function sendPersistData(data){if(registrationDfd!=="resolved"){if(data.xmlData)resolved_data.persistData=JSON.parse(data.xmlData).persist;registrationDfd.resolve(resolved_data);registrationDfd="resolved"}else{setPersistData.call(this,data)}}function getData(request){var name=void 0;var response=null;if(request)name=request.name;return new Promise(function(resolve,reject){try{if(name==="persistdata"){response=_persist}else{response=container.getData(request);if(response)response=acs._fromContainerData(name,response)}}catch(e){reject('getData({"name":"'+request.name+'"} throws Exception : "'+e.message+'"')}if(request.async)request.async(response);resolve(response)})}function processEvent(e){if(Object.prototype.toString.call(e)==="[object String]"){e=JSON.parse(e)}if(e.channel===ARCHIVE_RESPONSE_CHANNEL){sendPersistData.call(this,e,JETAppData.ID)}else{this._onProcessEvent(e)}}},{}],7:[function(require,module,exports){function DesktopXML(aWindow){function mixin(obj){function mix(target,source){for(var propName in source){target[propName]=source[propName]}return target}for(var i=1,l=arguments.length;i<l;i++){mix(obj||{},arguments[i])}return obj}function mergeArrayPropsToObjProps(objProperties,arrayProperties){for(var i=0;i<arrayProperties.length;i++){var prop=arrayProperties[i];var name=null;var value=null;if(prop.name){name=prop.name;value=prop.text||prop.value||""}else{for(var field in prop){if(prop.hasOwnProperty(field)){name=field;value=prop[field]||"";break}}}if(name!=null&&value!=null){objProperties[name]={value:value,type:prop.type||"xs:string",access:prop.access==="ro"?"ro":"rw"}}}}var DOMParser=aWindow.DOMParser?new aWindow.DOMParser:null;function wrapCData(input){return"<![CDATA["+unwrapCData(input)+"]]>"}function unwrapCData(input){var re=/\<\!\[CDATA\[|\]\]\>/gi;return input.replace(re,"")}function _present(v,t){if(v===undefined||v!==v){return false}else if(t=="array"){return Array.isArray(v)}else{return typeof v===t}}function _req(item,propNames,type){if(!Array.isArray(propNames)){propNames=[propNames]}propNames.forEach(function(p){if(!_present(item[p],type))throw new Error(p+" field is not specified!")})}function _reqa(item,propNames,min,max){if(min===undefined||min===null){min=1}if(max===undefined||max===null){max=Number.POSITIVE_INFINITY}if(!Array.isArray(propNames)){propNames=[propNames]}propNames.forEach(function(p){if(_present(item[p],"array")){if(item[p].length<min||item[p].length>max){throw new Error("Array "+p+" out of range("+min+", "+max+")")}}})}function _oneOf(v,values){for(var i=0;i<values.length;i++){if(v==values[i])return}throw new Error("Field has invalid value: "+v)}function _escapeString(str){if(str.indexOf("<![CDATA[")>-1)return str;str=str.replace(/&/g,"&amp;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");str=str.replace(/"/g,"&quot;");str=str.replace(/'/g,"&apos;");return str}function _getLocationXML(nodeName,locationData){var xml="<"+nodeName;if(_present(locationData.x,"number"))xml+=' x="'+locationData.x+'"';if(_present(locationData.y,"number"))xml+=' y="'+locationData.y+'"';if(_present(locationData.width,"number"))xml+=' width="'+locationData.width+'"';if(_present(locationData.height,"number"))xml+=' height="'+locationData.height+'"';if(_present(locationData.relative,"boolean"))xml+=' relative="'+locationData.relative+'"';xml+=" />";return xml}function _getEventDataXML(nodeName,data){var xml="<"+nodeName+">";if(data.aUrl)xml+='<Anchor url="'+_escapeString(data.aUrl)+'" />';if(data.imgUrl)xml+='<Image url="'+_escapeString(data.imgUrl)+'" />';if(data.mouse)xml+=_getMouseXML("Mouse",data.mouse);if(data.entities&&data.entities.length)xml+=_getContextDataXML("Entities",data.entities);if(data.menu)xml+=_getCommandBarsXML("ContextMenu",data.menu);xml+="</"+nodeName+">";return xml}function _getMouseXML(nodeName,mouseData){var xml="<"+nodeName;if(_present(mouseData.screenX,"number"))xml+=' screenx="'+mouseData.screenX+'"';if(_present(mouseData.screenY,"number"))xml+=' screeny="'+mouseData.screenY+'"';if(_present(mouseData.clientX,"number"))xml+=' clientx="'+mouseData.clientX+'"';if(_present(mouseData.clientY,"number"))xml+=' clienty="'+mouseData.clientY+'"';return xml+" />"}function _getEntityXML(nodeName,e){var entity={};mixin(entity,e);var xml="<"+nodeName;if(_present(entity.type,"string"))xml+=' type="'+_escapeString(entity.type)+'"';delete entity.type;if(_present(entity.dataSource,"string"))xml+=' datasource="'+_escapeString(entity.dataSource)+'"';xml+=">";delete entity.dataSource;if(entity.fields){for(var field in entity.fields){xml+='<Field name="'+_escapeString(field)+'">';if(_present(entity.fields[field],"string"))xml+=_escapeString(entity.fields[field]);xml+="</Field>"}}delete entity.fields;if(entity.entities){_req(entity,"entities","array");entity.entities.forEach(function(item){xml+=_getEntityXML("Entity",item)})}delete entity.entities;for(var propName in entity){if(propName in{NavigationNS:"",SelectionNS:"",Transaction:""}){xml+='<Field name="'+_escapeString(propName)+'">';if(_present(entity[propName],"string"))xml+=_escapeString(entity[propName]);xml+="</Field>"}else if(propName!=="IdentifierList"&&propName!=="FieldList"){xml+='<Identifier namespace="'+_escapeString(propName)+'">';if(_present(entity[propName],"string"))xml+=_escapeString(entity[propName]);xml+="</Identifier>"}}xml+="</"+nodeName+">";return xml}function _getContextDataXML(nodeName,contextData){var xml="<"+nodeName+">";if(contextData.length>0){contextData.forEach(function(e){xml+=_getEntityXML("Entity",e)})}xml+="</"+nodeName+">";return xml}function _getCommandBarDefaultAttrsXML(item){_req(item,"id","string");var xml=' ID="'+_escapeString(item.id)+'"';if(_present(item.tooltip,"string")){xml+=' tooltip="'+_escapeString(item.tooltip)+'"'}if(_present(item.icon,"string")){xml+=' icon="'+_escapeString(item.icon)+'"'}if(_present(item.enabled,"boolean")){xml+=' enabled="'+item.enabled+'"'}if(_present(item.description,"string")){xml+=' description="'+_escapeString(item.description)+'"'}if(_present(item.iconURL,"string")){xml+=' iconURL="'+_escapeString(item.iconURL)+'"'}if(_present(item.beginGroup,"boolean")){xml+=' beginGroup="'+item.beginGroup+'"'}if(_present(item.groupName,"string")){xml+=' groupName="'+_escapeString(item.groupName)+'"'}return xml}function _getButtonAttrsXML(item){var xml=_getCommandBarDefaultAttrsXML(item);_req(item,"caption","string");xml+=' caption="'+_escapeString(item.caption)+'"';if(_present(item.checked,"boolean"))xml+=' checked="'+item.checked+'"';if(_present(item.type,"string")){_oneOf(item.type,["iconOnly","iconAndCaption","captionOnly"]);xml+=' type="'+item.type+'"'}return xml}function _getControlAttrsXML(control){var xml=_getCommandBarDefaultAttrsXML(control);if(_present(control.caption,"string"))xml+=' caption="'+_escapeString(control.caption)+'"';return xml}function _getButtonXML(button){var xml="<Button"+_getButtonAttrsXML(button)+" />";return xml}function _getSystemMenuXML(button){var xml="<SystemMenu"+_getSystemMenuAttrsXML(button)+" />";return xml}function _getComboBoxXML(comboBox){var xml="<ComboBox"+_getControlAttrsXML(comboBox);if(_present(comboBox.type,"string")){_oneOf(comboBox.type,["dropDown","comboBox"]);xml+=' type="'+comboBox.type+'"'}if(_present(comboBox.dropDownWidth,"number"))xml+=' maxlength="'+comboBox.dropDownWidth+'"';xml+=" >";if(comboBox.items){comboBox.items.forEach(function(item){_req(item,"caption","string");xml+='<ListItem caption="'+_escapeString(item.caption)+'"';if(_present(item.selected,"boolean"))xml+=' selected="'+item.selected+'"';if(_present(item.id,"string"))xml+=' ID="'+_escapeString(item.id)+'"';xml+=" />"})}xml+="</ComboBox>";return xml}function _getMenuControlsXML(menuItem){var xml="";if(menuItem.items){menuItem.items.forEach(function(item){_req(item,"item","string");switch(item.item){case"Button":xml+=_getButtonXML(item);break;case"SplitButton":xml+=_getSplitButtonXML(item);break;case"Menu":xml+=_getMenuXML(item);break;case"Separator":xml+=_getSeparatorXML(item);break;default:throw new Error("Invalid item type specified: "+item.item)}})}return xml}function _getSplitButtonXML(splitButton){var xml="<SplitButton"+_getButtonAttrsXML(splitButton)+">";_req(splitButton,"items","array");_reqa(splitButton,"items");if(splitButton.items)xml+=_getMenuControlsXML(splitButton);xml+="</SplitButton>";return xml}function _getMenuXML(menu){var xml="<Menu"+_getButtonAttrsXML(menu)+">";_req(menu,"items","array");_reqa(menu,"items");if(menu.items)xml+=_getMenuControlsXML(menu);xml+="</Menu>";return xml}function _getSystemMenuAttrsXML(menu){_req(menu,"id","string");var xml=' ID="'+_escapeString(menu.id)+'"';if(_present(menu.enabled,"boolean"))xml+=' enabled="'+menu.enabled+'"';if(_present(menu.visible,"boolean"))xml+=' visible="'+menu.visible+'"';_reqa(menu,"items");if(menu.items)xml+=_getSystemMenuXML(menu);return xml}function _getSearchXML(search){var xml="<Search";if(_present(search.id,"string"))xml+=' ID="'+_escapeString(search.id)+'"';xml+="/>";return xml}function _getSeparatorXML(separator){var xml="<Separator />";return xml}function _getEditXML(edit){var xml="<Edit"+_getControlAttrsXML(edit);if(_present(edit.text,"string"))xml+=' text="'+_escapeString(edit.text)+'"';if(_present(edit.maxLength,"number")){if(edit.maxLength<0)throw new Error("Negative value was used for maxLength: "+edit.maxLength);xml+=' maxlength="'+edit.maxLength+'"'}xml+=" />";return xml}function _getPrintXML(print){_req(print,"id","string");_oneOf(print.id,["PRINT"]);var xml='<Print ID="PRINT" />';return xml}function _getCommandBarXML(nodeName,commandBar){var xml="<"+nodeName;if(_present(commandBar.caption,"string"))xml+=' caption="'+_escapeString(commandBar.caption)+'"';if(_present(commandBar.category,"number"))xml+=' category="'+commandBar.category+'"';xml+=">";_req(commandBar,"items","array");_reqa(commandBar,"items");if(commandBar.items){commandBar.items.forEach(function(item){_req(item,"item","string");switch(item.item){case"Button":xml+=_getButtonXML(item);break;case"SplitButton":xml+=_getSplitButtonXML(item);break;case"Menu":xml+=_getMenuXML(item);break;case"Separator":xml+=_getSeparatorXML(item);break;case"Search":xml+=_getSearchXML(item);break;case"Edit":xml+=_getEditXML(item);break;case"ComboBox":xml+=_getComboBoxXML(item);break;case"Print":xml+=_getPrintXML(item);break;case"System":xml+=_getSystemMenuXML(item);break;case"Header":break;default:throw new Error("Invalid item type specified: "+item.item)}})}xml+="</"+nodeName+">";return xml}function _getUpdateCommandBarsXML(nodeName,data){var xml="<"+nodeName+">";if(data.commandBarType&&Array.isArray(data.commandBars)){xml+=_getCommandBarsXML(data.commandBarType,data.commandBars)}xml+="</"+nodeName+">";return xml}function _getCommandBarsXML(nodeName,commandBars){var xml="<"+nodeName+">";if(Array.isArray(commandBars)){commandBars.forEach(function(cb){xml+=_getCommandBarXML("CommandBar",cb)})}xml+="</"+nodeName+">";return xml}function _getPropertyXML(propName,propObj){var xml="<Property";if(propObj.type){xml+=' type="'+_escapeString(propObj.type)+'"'}if(propObj.access){xml+=' access="'+propObj.access+'"'}if(propName){xml+=' name="'+_escapeString(propName)+'">'}if(propObj.value){xml+=_escapeString(propObj.value)}xml+="</Property>";return xml}function _getPropertiesXML(nodeName,properties){var xml="<"+nodeName+">";for(var prop in properties){if(properties.hasOwnProperty(prop)){xml+=_getPropertyXML(prop,properties[prop])}}xml+="</"+nodeName+">";return xml}function _getPDataXML(data){var xml="<PData";if(_present(data.name,"string"))xml+=' name="'+_escapeString(data.name)+'"';xml+=">";if(_present(data.value,"string"))xml+=wrapCData(data.value);xml+="</PData>";return xml}function _getArchiveDataXML(nodeName,data){data=data||[];var xml="<"+nodeName,pData=Array.isArray(data)?data:data.data;if(_present(data.service,"string"))xml+=' service="'+_escapeString(data.service)+'"';if(_present(data.title,"string"))xml+=' title="'+_escapeString(data.title)+'"';if(_present(data.extension,"string"))xml+=' extension="'+_escapeString(data.extension)+'"';xml+=">";if(_present(data.cpurl,"string")){xml+='<Url cpurl="'+_escapeString(data.cpurl)+'">';xml+=_escapeString(_present(data.url,"string")?data.url:data.cpurl);xml+="</Url>"}else if(_present(data.url,"string")){xml+="<Url>"+_escapeString(data.url)+"</Url>"}if(pData){pData.forEach(function(p){xml+=_getPDataXML(p)})}xml+="</"+nodeName+">";return xml}function _getNavigationXML(nodeName,nav){var xml="<"+nodeName;if(_present(nav.url,"string"))xml+=' url="'+_escapeString(nav.url)+'"';if(_present(nav.name,"string"))xml+=' name="'+_escapeString(nav.name)+'"';if(_present(nav.target,"string")){xml+=' target="'+nav.target+'"'}xml+=">";if(nav.entities)xml+=_getContextDataXML("Entities",nav.entities);if(nav.archive)xml+=_getArchiveDataXML("PersistData",nav.archive);if(nav.location)xml+=_getLocationXML("Location",nav.location);if(nav.properties){var properties={};mergeArrayPropsToObjProps(properties,nav.properties);xml+=_getPropertiesXML("Properties",properties)}xml+="</"+nodeName+">";return xml}function _getTransferDataXML(nodeName,data){var xml="<"+nodeName;if(data.mouse){if(_present(data.mouse.screenX,"number"))xml+=' screenx="'+data.mouse.screenX+'"';if(_present(data.mouse.screenY,"number"))xml+=' screeny="'+data.mouse.screenY+'"'}xml+=">";if(data.entities&&data.entities.length){xml+='<Data type="ContextData">';xml+=_getContextDataXML("Entities",data.entities);xml+="</Data>"}if(data.archive){xml+='<Data type="PersistData">';xml+=_getArchiveDataXML("PersistData",data.archive);xml+="</Data>"}xml+="</"+nodeName+">";return xml}function _getSearchTargetXML(nodeName,data){var xml="<"+nodeName;if(_present(data.multipleMatches,"boolean"))xml+=' multipleMatches="'+data.multipleMatches+'"';if(_present(data.contextResolution,"boolean"))xml+=' contextResolution="'+data.contextResolution+'"';xml+=">";if(data.constraints){data.constraints.forEach(function(c){_req(c,"namespace","string");xml+='<Constraint namespace="'+c.namespace+'">';if(c.contextDataTransformation!==null&&c.contextDataTransformation!==undefined){xml+="<ContextDataTransformation>"+c.contextDataTransformation+"</ContextDataTransformation>"}if(c.definitions){c.definitions.forEach(function(d){xml+="<Definition";if(_present(d.name,"string"))xml+=' name="'+_escapeString(d.name)+'"';xml+=">";if(_present(d.value,"string"))xml+=_escapeString(d.value);xml+="</Definition>"})}xml+="</Constraint>"})}return xml}function _getDescriptionXML(nodeName,data){var xml="<"+nodeName+">";if(_present(data.summary,"string"))xml+="<Summary>"+_escapeString(data.summary)+"</Summary>";if(data.toolbar)xml+=_getCommandBarsXML("Toolbar",data.toolbar.commandBars);if(data.serviceMenu)xml+=_getCommandBarsXML("ServiceMenu",data.serviceMenu);if(data.apptitlebar)xml+=_getCommandBarsXML("AppTitleBar",data.apptitlebar);if(data.appmenu)xml+=_getCommandBarsXML("AppMenu",data.appmenu);if(data.entities&&data.entities.length)xml+=_getContextDataXML("Context",data.entities);if(data.searchTarget)xml+=_getSearchTargetXML("SearchTarget",data.searchTarget);if(data.properties)xml+=_getPropertiesXML("Properties",data.properties);xml+="</"+nodeName+">";return xml}function _getLogXML(nodeName,data){var xml="<"+nodeName+">";_req(data,"messages","array");_reqa(data,"messages");data.messages.forEach(function(m){_req(m,"text","string");xml+="<Message";if(_present(m.severity,"string")){_oneOf(m.severity,["critical","high","warning","information","debug"]);xml+=' severity="'+m.severity+'"'}if(_present(m.text,"string"))xml+=' text="'+_escapeString(m.text)+'"';if(_present(m.source,"string"))xml+=' source="'+_escapeString(m.source)+'"';xml+=" />"});xml+="</"+nodeName+">";return xml}function _getClipboardDataXML(nodeName,data){var xml="<"+nodeName+">";data.entries.forEach(function(e){_req(e,"name","string");xml+='<Entry name="'+_escapeString(e.name)+'">';if(_present(e.value,"string"))xml+=_escapeString(e.value);xml+="</Entry>"});xml+="</"+nodeName+">";return xml}function _getToastXML(nodeName,data){_req(data,"id","string");var xml="<"+nodeName+' ID="'+_escapeString(data.id)+'"';if(_present(data.value,"string"))xml+=' value="'+_escapeString(data.value)+'"';if(_present(data.duration,"number"))xml+=' duration="'+data.duration+'"';xml+=">";_req(data,"title","string");xml+="<Title>"+_escapeString(data.title)+"</Title>";if(_present(data.message,"string"))xml+="<Message>"+_escapeString(data.message)+"</Message>";if(_present(data.icon,"string"))xml+="<Icon>"+_escapeString(data.icon)+"</Icon>";if(_present(data.iconUrl,"string"))xml+="<IconUrl>"+_escapeString(data.iconUrl)+"</IconUrl>";xml+="</"+nodeName+">";return xml}function _getSessionXML(nodeName,data){_req(data,"version","string");_req(data,"id","string");var r=new RegExp("^[0-9]+\\.[0-9]+\\.[0-9]+$");if(!r.test(data.version))throw new Error("Invalid version was specified: "+data.version);var xml="<"+nodeName+' version="'+data.version+'" ID="'+_escapeString(data.id)+'"/>';return xml}function _getStoreDataXML(nodeName,data){var xml="<"+nodeName;if(data.title){xml+=' title="'+_escapeString(data.title)+'"'}if(data.category){xml+=' category="'+_escapeString(data.category)+'"'}if(data.path){xml+=' path="'+_escapeString(data.path)+'"'}xml+=">";xml+="<PData>";xml+='<SearchTarget xmlns="http://www.reuters.com/ns/2005/06/21/ccf">';if(data.constraints&&Array.isArray(data.constraints)){data.constraints.forEach(function(constraint){xml+="<Constraint";if(constraint.namespace){xml+=' namespace="'+_escapeString(constraint.namespace)+'"'}xml+=">";if(constraint.definitions&&Array.isArray(constraint.definitions)){constraint.definitions.forEach(function(definition){xml+="<Definition";if(definition.viewId){xml+=' viewId="'+_escapeString(definition.viewId)+'"'}xml+=">";var _getPropertiesXML=function(properties){var propertiesXML="";if(Array.isArray(properties)){properties.forEach(function(property){propertiesXML+="<Property";if(property.name){propertiesXML+=' name="'+_escapeString(property.name)+'"'}propertiesXML+=">";if(property.properties){propertiesXML+=_getPropertiesXML(property.properties)}else if(property.value){propertiesXML+=_escapeString(property.value)}propertiesXML+="</Property>"})}return propertiesXML};if(definition.properties){xml+=_getPropertiesXML(definition.properties)}xml+="</Definition>"})}xml+="</Constraint>"})}xml+="</SearchTarget>";xml+="</PData>";xml+="</"+nodeName+">";return xml}function _stringToRootNode(str){var r;try{r=DOMParser.parseFromString(str,"text/xml")}catch(er){throw new Error("invalid xml!")}return r&&r.documentElement?r.documentElement:null}function _loadAttr(node,get,req,object,set){get=Array.isArray(get)?get:[get];set=set?Array.isArray(set)?set:[set]:get;get.forEach(function(g,i){var v=node.getAttribute(g);if(v){object[set[i]]=v}});return object}function _getEntityJson(entityNode){var entity={};_loadAttr(entityNode,["type","datasource"],false,entity,["type","dataSource"]);entity["IdentifierList"]=[];entity["FieldList"]=[];for(var i=0;i<entityNode.childNodes.length;i++){var node=entityNode.childNodes.item(i),item;switch(node.tagName){case"Identifier":item={};_loadAttr(node,"namespace",true,item);entity[item.namespace]=node.text||node.textContent||"";entity["IdentifierList"].push(item.namespace);break;case"Field":if(entity.fields===undefined||entity.fields===null){entity.fields={}}item={};_loadAttr(node,"name",true,item);var name=item.name;delete item.name;item[name]=node.text||node.textContent||"";entity["FieldList"].push(name);switch(name){case"SelectionNS":case"NavigationNS":case"Transaction":entity[name]=item[name];break;default:entity.fields[name]=item[name]}break;case"Entity":if(entity.entities===undefined||entity.entities===null){entity.entities=[]}entity.entities.push(_getEntityJson(node));break;default:return}}return entity}function _getContextDataJson(root){var data=[];for(var i=0;i<root.childNodes.length;i++){var node=root.childNodes.item(i);switch(node.nodeName){case"Entity":data.push(_getEntityJson(node));break}}return data}function _getCommandDataJson(root){return _loadAttr(root,["itemID","value","ID"],false,{},["itemId","value","id"])}function _getPropertiesJson(root){var data=[];if(root.tagName!="Properties")throw new Error("Properties node expected!");var props=[];for(var i=0;i<root.childNodes.length;i++){var node=root.childNodes.item(i);switch(node.nodeName){case"Property":var name=node.getAttribute("name"),property=_loadAttr(node,["type","access"],false,{});property[name]=node.text||node.textContent||"";props.push(property);break}}if(props.length>0)data=props;return data}function _getArchiveDataJson(root){var data=_loadAttr(root,["url","service","title","extension"],false,{}),pdatas=[];for(var n=0;n<root.childNodes.length;n++){var node=root.childNodes.item(n);switch(node.nodeName){case"Url":data.url=node.text||node.textContent||"";_loadAttr(node,"cpurl",false,data);break;case"PData":var pdata=_loadAttr(node,"name",false,{});var fc=node.firstChild;if(pdata.name=="context"){if(fc!==null&&fc!==undefined&&fc.xml){pdata.value=fc.xml}else{pdata.value="";var s=new XMLSerializer;for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes.item(i);pdata.value+=s.serializeToString(childNode)}}}else{if(fc!==null&&fc!==undefined){pdata.value=node.text||node.textContent||""}else{pdata.value=""}}pdatas.push(pdata);break}}if(pdatas.length>0)data.data=pdatas;return data}function _getDescriptionJson(root){var data=_loadAttr(root,["name","logLevel","version","containerVersion","productVersionInfo","userAgent","guid"],false,{}),nodeMap={Capabilities:function(node,data){for(var c=0;c<node.childNodes.length;c++){var n=node.childNodes.item(c);var capability=_loadAttr(n,["name","namespace","type"],false,{});if(_present(capability.type,"string"))_oneOf(capability.type,["SYNC","ASYNC","BOTH"]);var value=n.text||n.textContent||"";if(value.length>0)capability.value=value;data.capabilities[capability.name]=capability;delete capability.name}},JetPluginInfo:function(node,data){var plugin={};_loadAttr(node,"ChannelName",true,plugin,"channel");data.plugin=plugin},HttpHandler:function(node,data){var capability={};_loadAttr(node,"url",true,capability,"value");data.GUID=capability.value.substring(capability.value.indexOf("id=")+3);capability.value=capability.value.substring(0,capability.value.indexOf("?id="));data.capabilities.httpGetData=capability},Properties:function(node,data){data.properties=_getPropertiesJson(node)},WindowInfo:function(node,data){var windowInfo=_loadAttr(node,["windowId","isFlexViewer"],true,{});windowInfo.isFlexViewer=windowInfo.isFlexViewer==="true";windowInfo.windowId=windowInfo.windowId;if(windowInfo.windowId){if(windowInfo.windowId.charAt(0)==="{"){windowInfo.windowId=windowInfo.windowId.replace("{","")}if(windowInfo.windowId.charAt(windowInfo.windowId.length-1)==="}"){windowInfo.windowId=windowInfo.windowId.replace("}","")}windowInfo.windowId=windowInfo.windowId.toLowerCase()}data.windowInfo=windowInfo}};if(data.guid){data.GUID=data.guid.replace(/-/g,"");delete data.guid}data.capabilities={};for(var i=0;i<root.childNodes.length;i++){var node=root.childNodes.item(i);if(node.nodeType!=3)nodeMap[node.nodeName].call(this,node,data)}return data}function _getUserInfoJson(root){var data={};if(root.tagName!="UserInfo")throw new Error("UserInfo node expected!");for(var i=0;i<root.childNodes.length;i++){var node=root.childNodes.item(i);if(node.nodeType==1){var value=node.text||node.textContent||"";data[node.tagName]=value}}return data}function _getContainerInformationJson(root){var data={};if(root.tagName!="ContainerInfo")throw new Error("ContainerInfo node expected!");_loadAttr(root,"GUID",true,data);_loadAttr(root,"RootPersistencyFolder",true,data);return data}function _getTransferDataJson(root){var data={};if(root.tagName!="TransferData")throw new Error("TransferData node expected!");var mouse={};_loadAttr(root,"screenx",false,mouse,"screenX");_loadAttr(root,"screeny",false,mouse,"screenY");var xPresent=_present(mouse.screenX,"string")&&mouse.screenX;var yPresent=_present(mouse.screenY,"string")&&mouse.screenY;if(xPresent||yPresent){if(xPresent)mouse.screenX=JSON.parse(mouse.screenX);if(yPresent)mouse.screenY=JSON.parse(mouse.screenY);data.mouse=mouse}for(var i=0;i<root.childNodes.length;i++){var node=root.childNodes.item(i);switch(node.nodeName){case"Data":var dataType=node.getAttribute("type");if(dataType=="ContextData"||dataType=="PersistData"){for(var _n=0;_n<node.childNodes.length;_n++){var n=node.childNodes.item(_n);switch(n.nodeName){case"Entities":if(dataType!="ContextData")throw new Error("ContextData data type expected instead of "+dataType);data.entities=_getContextDataJson(n);break;case"PersistData":if(dataType!="PersistData")throw new Error("PersistData data type expected instead of "+dataType);

data.archive=_getArchiveDataJson(n);break}}}break;case"Entities":data.entities=_getContextDataJson(node);break}}return data}function _getBoolean(str){var res=JSON.parse(str);if("boolean"!=typeof res)throw new Error("Invalid boolean value specified: "+str);return res}function _getXYJson(str){var data={};var coords=str.split(",");var regex=new RegExp("^[0-9]+,[0-9]+$");if(!regex.test(str)||coords.length!=2)throw new Error("Invalid data format used!");data.x=JSON.parse(coords[0]);data.y=JSON.parse(coords[1]);return data}return{toMap:{onLog:{format:function(d){return _getLogXML("Log",d)}},onContextMenu:{format:function(d){return _getEventDataXML("EventData",d)}},onContextChange:{format:function(d){return _getContextDataXML("Entities",d)}},onContextDragStart:{format:function(d){return _getContextDataXML("Entities",d)}},onNavigate:{format:function(d){return _getNavigationXML("Navigation",d)}},onCopy:{format:function(d){return _getTransferDataXML("TransferData",d)}},onToast:{format:function(d){return _getToastXML("Toast",d)}},onPropertyChange:{format:function(d){return _getPropertiesXML("Properties",d)}},onLoad:{format:function(d){return _getDescriptionXML("Description",d)}},onUnload:{format:function(d){return _getArchiveDataXML("PersistData",d)}},persistdata:{format:function(d){return _getArchiveDataXML("PersistData",d)}},onUpdateCommandBars:{format:function(d){return _getUpdateCommandBarsXML("UpdateCommandBars",d)}},onCopyToClipboard:{format:function(d){return _getClipboardDataXML("ClipboardData",d)}},onSaveToStore:{format:function(d){return _getStoreDataXML("StoreData",d)}},onResize:{format:function(d){return _getLocationXML("Location",d)}},Session:{format:function(d){return _getSessionXML("Session",d)}},toTransferData:{format:function(d){return _getTransferDataXML("TransferData",d)}}},fromMap:{onContextChange:{format:function(d){return _getContextDataJson(_stringToRootNode(d))}},onPropertyChange:{format:function(d){return _getPropertiesJson(_stringToRootNode(d))}},onCommand:{format:function(d){return _getCommandDataJson(_stringToRootNode(d))}},ActiveSymbol:{format:function(d){return _getContextDataJson(_stringToRootNode(d))}},Description:{format:function(d){return _getDescriptionJson(_stringToRootNode(d))}},UserInfo:{format:function(d){return _getUserInfoJson(_stringToRootNode(d))}},"x,y":{format:function(d){return _getXYJson(d)}},Boolean:{format:function(d){return _getBoolean(d)}},ContainerInformation:{format:function(d){return _getContainerInformationJson(_stringToRootNode(d))}},persistdata:{format:function(d){return _getArchiveDataJson(_stringToRootNode(d))}},fromTransferData:{format:function(d){return _getTransferDataJson(_stringToRootNode(d))}}}}}module.exports=DesktopXML},{}],8:[function(require,module,exports){var _log;var _level=2;var _levels=["trace","debug","info","warn","error"];var _logSource="";var _desktopLevels=["debug","information","warning","high","critical"];function setup(acs,isDesktop){acs.setLogOptions=function(level){_level=level===void 0||level===null?10:level;_levels.forEach(function(level,index){acs[level]=setLog(index)})};acs.setLogOptions(_level);if(isDesktop){acs.log=function(msg){acs._processEvent(window,{name:"onLog",data:msg})};_desktopLevels.forEach(function(name){acs[name]=function(message){acs.log({messages:[{severity:name,text:message,source:_logSource}]})}});acs.loggingSource=function(source){_logSource=source}}else{acs.log=function(){log(arguments)}}}function log(){var params=[];var len=arguments.length;for(var i=0;i<len;i++){params.push(arguments[i])}params=params.map(function(p){return typeof p==="function"?p():typeof p==="string"?p:!p?"":Array.isArray(p)?p.join(" "):JSON.stringify(p)});console.log(params.join(""))}function setLog(level){if(_level<=level)return function(){log.apply(this,arguments)};return function(){}}module.exports=function(acs,isDesktop){if(typeof acs==="undefined")throw new Error("tried to initialize a logger with undefined.");setup(acs,isDesktop)}},{}],9:[function(require,module,exports){var _top;var frameManager;var PromiseHandler=require("./PromiseHandler");var promiseHandler;function messageForJET(message){if(message){if(message.lastIndexOf){if(message.lastIndexOf("acs--jet--",0)===0)return true}}return false}function MessageManager(source,options){options=options||{};this._parsers=[];this.name=Math.floor(Math.random()*1e3)+1+"(acs_master)";promiseHandler=PromiseHandler(this.name);this._isACS=true;frameManager=options.frameManager;var aWindow=frameManager.getWindow();_top=options.frameManager.getFrame();if(options.sameWindowStrategy){aWindow.__ACSMessageShim__=this._messageHandlerSameWindow.bind(this);this.sendMessage=function(where,options){options=options||{};if(aWindow.__JETMessageShim__)aWindow.__JETMessageShim__(where,options);else throw new Error("ACS could not find the JETMessageShim.")}}else{this.init(source);this.sendMessage=function(where,options){options=options||{};where.postMessage(this._makeMessage(options),"*")}}this.sendPromise=function(where,options){options=options||{};var promiseIndex=promiseHandler.makePromise();options.promiseIndex=promiseIndex;this.sendMessage(where,options);return promiseHandler.getDeferred(promiseIndex)}}MessageManager.prototype={init:function(source){this.source=source;this.boundOnMessage=this._messageHandler.bind(this);if(this.source.addEventListener)this.source.addEventListener("message",this.boundOnMessage,false);if(this.source.attachEvent)this.source.attachEvent("onmessage",this.boundOnMessage,false);this.removeListener=function(){if(this.source.removeEventListener)this.source.removeEventListener("message",this.boundOnMessage,false);if(this.source.detachEvent)this.source.detachEvent("onmessage",this.boundOnMessage,false)};return this},addStringToParser:function(parser){this._parsers.push(parser)},_parseData:function(dataString){var parsers=this._parsers;var numberOfParsers=parsers.length;if(numberOfParsers>0){for(var i=0;i<numberOfParsers;i++){var parserString=parsers[i];if(Object.prototype.toString.call(dataString)==="[object String]"){if(dataString.match(parserString)){dataString=dataString.replace(parserString,"");try{return JSON.parse(dataString)}catch(e){return}}}else if(typeof dataString==="object"){return dataString}}}else{try{return JSON.parse(dataString)}catch(e){return dataString}}},_makeMessage:function(options){options=options||{};var key="";if(options.parseKey)key+=options.parseKey;return key+JSON.stringify({params:options.params,promiseIndex:options.promiseIndex,funcName:options.funcName,parseKey:options.parseKey,senderId:"acs--jet--"+this.name,attachSource:options.attachSource,name:this.name})},_messageHandler:function(event){var source=event.source;var origin=event.origin;var data=this._parseData(event.data);if(!data.targetId){if(data.funcName)this._handleMessage(event.source,data)}else if(messageForJET(data.senderId)){this._handleEikonMessage(data)}},_messageHandlerSameWindow:function(window,data){var source=window;var origin="";if(!data.targetId){if(data.funcName)this._handleMessage(window,data)}else if(messageForJET(data.senderId)){this._handleEikonMessage(data)}},_handleMessage:function(source,data){var context=this;var funcName=data.funcName;var params=data.params;var promiseIndex=data.promiseIndex;var attachSource=data.attachSource;switch(funcName){case"handshake":this.sendMessage(source,{promiseIndex:promiseIndex,parseKey:data.parseKey,funcName:"replyHandshake"});break;case"replyHandshake":promiseHandler.resolvePromise(promiseIndex,true);break;case"replyPromiseResolve":promiseHandler.resolvePromise(promiseIndex,params);break;case"replyPromiseReject":promiseHandler.rejectPromise(promiseIndex,params);break;case"setRegisterData":this.registerData=data.params;this.topAppInstanceId=this.registerData.instanceId;this.topAppAppId=this.registerData.appId;delete this.registerData.instanceId;delete this.registerData.appId;break;case"getRegisterData":if(this.registerData&&promiseIndex){this.sendMessage(source,{promiseIndex:promiseIndex,parseKey:data.parseKey,funcName:"replyRegisterData",params:this.registerData})}else{this.sendMessage(source,{parseKey:data.parseKey,funcName:"replyRegisterData"})}break;case"replyRegisterData":if(params){promiseHandler.resolvePromise(promiseIndex,params)}else{promiseHandler.rejectPromise(promiseIndex,false)}break;default:if(attachSource){params.unshift(source)}if(promiseIndex){var fn;var scope;scope=this.__getFunc(funcName);if(scope){fn=scope[funcName];if(typeof fn==="function"){function returnPromise(options){options=options||{};options.parseKey="jet:msg";context.sendMessage(source,options)}fn.apply(scope,params).then(function success(data){var options={funcName:"replyPromiseResolve",source:source,params:data,promiseIndex:promiseIndex};returnPromise(options)},function error(error){var options={funcName:"replyPromiseReject",params:[error.toString(),error.stack],promiseIndex:promiseIndex};returnPromise(options)})}}}else{scope=this.__getFunc(funcName);if(scope){fn=scope[funcName];if(typeof fn==="function")fn.apply(scope,params)}}}},_handleEikonMessage:function(data){if(this._isACS){this._isACS._onProcessEvent(data)}else{this.sendMessage(_top,{parseKey:"jet:msg",params:[data.data],attachSource:true,funcName:"_onProcessEventWithSource"})}},__namespaces__:[],registerNamespace:function(namespace){this.__namespaces__.push(namespace)},__getFunc:function(funcName){var scope=void 0;var namespaces=this.__namespaces__;var numberNamespaces=namespaces.length;for(var i=0;i<numberNamespaces;i++){var namespace=namespaces[i];if(namespace[funcName]){scope=namespace;break}}return scope}};module.exports=MessageManager},{"./PromiseHandler":10}],10:[function(require,module,exports){module.exports=function PromiseHandler(name){var promiseIndex=1;var name=name;var promises={};var deferreds={};return{makePromise:function(){var index=promiseIndex++ +"_"+name;var promise=new Promise(function(resolve,reject){deferreds[index]={resolve:resolve,reject:reject}});promises[index]=promise;return index},getDeferred:function(id){return deferreds[id]},getPromise:function(id){return promises[id]},cleanPromise:function(id,type){deferreds[id]=type;promises[id]=type},resolvePromise:function(id,params){var promise=this.getDeferred(id);if(promise&&promise.resolve){promise.resolve(params);this.cleanPromise(id,"resolved")}},rejectPromise:function(id,params){var promise=this.getDeferred(id);if(promise&&promise.reject){promise.reject(params);this.cleanPromise(id,"rejected")}}}}},{}],11:[function(require,module,exports){var cache={properties:{},persistdata:[]};var dataProviders={};function getter(v){return function(){return function(){return cache[v]}}}function setter(key){return function(value){cache[key]=value}}Object.defineProperties(dataProviders,{helpurl:{get:getter("helpurl"),set:setter("helpurl")},context:{get:getter("context"),set:setter("context")},properties:{get:getter("properties"),set:setter("properties")},description:{get:getter("description"),set:setter("description")},persistdata:{get:getter("persistdata"),set:setter("persistdata")},inputowners:{get:getter("inputowners"),set:setter("inputowners")}});module.exports=function(){return{dataProviders:dataProviders}}},{}],12:[function(require,module,exports){module.exports=function(aWindow){var uaString=setUAString(aWindow);var _top=void 0;var _inframe=void 0;inFrame();setFrame(_inframe);function setFrame(inIframe){_top=inIframe?aWindow.top:aWindow;return _top}function inFrame(){var result;try{result=aWindow.self!==aWindow.top}catch(e){result=false}if(!isDesktop(uaString))result=false;_inframe=result}return{setOnFrame:function(key,value,force){if(!_top[key]||force){_top[key]=value}},getFrame:function(){return _top},getWindow:function(){return aWindow},inFrame:function(){return _inframe},isDesktop:function(){return isDesktop(uaString)}}};function setUAString(aWindow){var uaString;try{uaString=aWindow.navigator.userAgent}catch(e){uaString="???"}return uaString}function isDesktop(str){return str.indexOf("EikonViewer")>-1}},{}],13:[function(require,module,exports){(function(process,global){require("es6-promise").polyfill();var aWindow=getWindow();var MessageManager=require("./MessageManager");var FrameManager=require("./frameManager");var frameManager=FrameManager(getWindow());var _top=frameManager.getFrame();var ACS=require("./AppContainerShim");var ACSFactory=require("./AppContainerShimFactory");ACSFactory({MessageManager:MessageManager,frameManager:frameManager,ACS:ACS,aWindow:getWindow(),eikonNow:aWindow.eikonNow});function isNode(){return typeof process==="object"&&process+""==="[object process]"}function getWindow(){if(isNode())return global.aWindow;else return window}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./AppContainerShim":4,"./AppContainerShimFactory":5,"./MessageManager":9,"./frameManager":12,_process:1,"es6-promise":2}],14:[function(require,module,exports){module.exports={addEventToSource:function(wind,event,func){this.addEvent(wind,"message",func)},removeEventFromSource:function(wind,event,func){this.removeEvent(wind,"message",func)},removeEvent:function(wind,key,func){if(wind.removeEventListener)wind.removeEventListener(key,func,false);if(wind.detachEvent)wind.detachEvent("on"+key,func,false)},addEvent:function(wind,key,func){if(wind.addEventListener)wind.addEventListener(key,func,false);if(wind.attachEvent)wind.attachEvent("on"+key,func,false)}}},{}]},{},[13]);;!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function testSchema(instance,options,ctx,schema){return this.validateSchema(instance,schema,options,ctx).valid}function testAdditionalProperty(instance,schema,options,ctx,property,result){if(!schema.properties||void 0===schema.properties[property])if(schema.additionalProperties===!1)result.addError({name:"additionalProperties",argument:property,message:"additionalProperty "+JSON.stringify(property)+" exists in instance when not allowed"});else{var additionalProperties=schema.additionalProperties||{},res=this.validateSchema(instance[property],additionalProperties,options,ctx.makeChild(additionalProperties,property));res.instance!==result.instance[property]&&(result.instance[property]=res.instance),result.importErrors(res)}}function testArrays(v,i,a){var j,len=a.length;for(j=i+1,len;j<len;j++)if(helpers.deepCompareStrict(v,a[j]))return!1;return!0}var helpers=require("./helpers"),ValidatorResult=helpers.ValidatorResult,SchemaError=helpers.SchemaError,attribute={};attribute.ignoreProperties={id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0};var validators=attribute.validators={};validators.type=function(instance,schema,options,ctx){if(void 0===instance)return null;var result=new ValidatorResult(instance,schema,options,ctx),types=schema.type instanceof Array?schema.type:[schema.type];if(!types.some(this.testType.bind(this,instance,schema,options,ctx))){var list=types.map(function(v){return v.id&&"<"+v.id+">"||v+""});result.addError({name:"type",argument:list,message:"is not of a type(s) "+list})}return result},validators.anyOf=function(instance,schema,options,ctx){if(void 0===instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);if(!(schema.anyOf instanceof Array))throw new SchemaError("anyOf must be an array");if(!schema.anyOf.some(testSchema.bind(this,instance,options,ctx))){var list=schema.anyOf.map(function(v,i){return v.id&&"<"+v.id+">"||v.title&&JSON.stringify(v.title)||v.$ref&&"<"+v.$ref+">"||"[subschema "+i+"]"});result.addError({name:"anyOf",argument:list,message:"is not any of "+list.join(",")})}return result},validators.allOf=function(instance,schema,options,ctx){if(void 0===instance)return null;if(!(schema.allOf instanceof Array))throw new SchemaError("allOf must be an array");var result=new ValidatorResult(instance,schema,options,ctx),self=this;return schema.allOf.forEach(function(v,i){var valid=self.validateSchema(instance,v,options,ctx);if(!valid.valid){var msg=v.id&&"<"+v.id+">"||v.title&&JSON.stringify(v.title)||v.$ref&&"<"+v.$ref+">"||"[subschema "+i+"]";result.addError({name:"allOf",argument:{id:msg,length:valid.errors.length,valid:valid},message:"does not match allOf schema "+msg+" with "+valid.errors.length+" error[s]:"}),result.importErrors(valid)}}),result},validators.oneOf=function(instance,schema,options,ctx){if(void 0===instance)return null;if(!(schema.oneOf instanceof Array))throw new SchemaError("oneOf must be an array");var result=new ValidatorResult(instance,schema,options,ctx),count=schema.oneOf.filter(testSchema.bind(this,instance,options,ctx)).length,list=schema.oneOf.map(function(v,i){return v.id&&"<"+v.id+">"||v.title&&JSON.stringify(v.title)||v.$ref&&"<"+v.$ref+">"||"[subschema "+i+"]"});return 1!==count&&result.addError({name:"oneOf",argument:list,message:"is not exactly one from "+list.join(",")}),result},validators.properties=function(instance,schema,options,ctx){if(void 0!==instance&&instance instanceof Object){var result=new ValidatorResult(instance,schema,options,ctx),properties=schema.properties||{};for(var property in properties){var prop=(instance||void 0)&&instance[property],res=this.validateSchema(prop,properties[property],options,ctx.makeChild(properties[property],property));res.instance!==result.instance[property]&&(result.instance[property]=res.instance),result.importErrors(res)}return result}},validators.patternProperties=function(instance,schema,options,ctx){if(void 0!==instance&&this.types.object(instance)){var result=new ValidatorResult(instance,schema,options,ctx),patternProperties=schema.patternProperties||{};for(var property in instance){var test=!0;for(var pattern in patternProperties){var expr=new RegExp(pattern);if(expr.test(property)){test=!1;var res=this.validateSchema(instance[property],patternProperties[pattern],options,ctx.makeChild(patternProperties[pattern],property));res.instance!==result.instance[property]&&(result.instance[property]=res.instance),result.importErrors(res)}}test&&testAdditionalProperty.call(this,instance,schema,options,ctx,property,result)}return result}},validators.additionalProperties=function(instance,schema,options,ctx){if(void 0!==instance&&this.types.object(instance)){if(schema.patternProperties)return null;var result=new ValidatorResult(instance,schema,options,ctx);for(var property in instance)testAdditionalProperty.call(this,instance,schema,options,ctx,property,result);return result}},validators.minProperties=function(instance,schema,options,ctx){if(!instance||"object"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx),keys=Object.keys(instance);return keys.length>=schema.minProperties||result.addError({name:"minProperties",argument:schema.minProperties,message:"does not meet minimum property length of "+schema.minProperties}),result},validators.maxProperties=function(instance,schema,options,ctx){if(!instance||"object"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx),keys=Object.keys(instance);return keys.length<=schema.maxProperties||result.addError({name:"maxProperties",argument:schema.maxProperties,message:"does not meet maximum property length of "+schema.maxProperties}),result},validators.items=function(instance,schema,options,ctx){if(!(instance instanceof Array))return null;var self=this,result=new ValidatorResult(instance,schema,options,ctx);return void 0!==instance&&schema.items?(instance.every(function(value,i){var items=schema.items instanceof Array?schema.items[i]||schema.additionalItems:schema.items;if(void 0===items)return!0;if(items===!1)return result.addError({name:"items",message:"additionalItems not permitted"}),!1;var res=self.validateSchema(value,items,options,ctx.makeChild(items,i));return res.instance!==result.instance[i]&&(result.instance[i]=res.instance),result.importErrors(res),!0}),result):result},validators.minimum=function(instance,schema,options,ctx){if("number"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx),valid=!0;return valid=schema.exclusiveMinimum&&schema.exclusiveMinimum===!0?instance>schema.minimum:instance>=schema.minimum,valid||result.addError({name:"minimum",argument:schema.minimum,message:"must have a minimum value of "+schema.minimum}),result},validators.maximum=function(instance,schema,options,ctx){if("number"!=typeof instance)return null;var valid,result=new ValidatorResult(instance,schema,options,ctx);return valid=schema.exclusiveMaximum&&schema.exclusiveMaximum===!0?instance<schema.maximum:instance<=schema.maximum,valid||result.addError({name:"maximum",argument:schema.maximum,message:"must have a maximum value of "+schema.maximum}),result},validators.divisibleBy=function(instance,schema,options,ctx){if("number"!=typeof instance)return null;if(0==schema.divisibleBy)throw new SchemaError("divisibleBy cannot be zero");var result=new ValidatorResult(instance,schema,options,ctx);return instance/schema.divisibleBy%1&&result.addError({name:"divisibleBy",argument:schema.divisibleBy,message:"is not divisible by (multiple of) "+JSON.stringify(schema.divisibleBy)}),result},validators.multipleOf=function(instance,schema,options,ctx){if("number"!=typeof instance)return null;if(0==schema.multipleOf)throw new SchemaError("multipleOf cannot be zero");var result=new ValidatorResult(instance,schema,options,ctx);return instance/schema.multipleOf%1&&result.addError({name:"multipleOf",argument:schema.multipleOf,message:"is not a multiple of (divisible by) "+JSON.stringify(schema.multipleOf)}),result},validators.required=function(instance,schema,options,ctx){var result=new ValidatorResult(instance,schema,options,ctx);return void 0===instance&&schema.required===!0?result.addError({name:"required",message:"is required"}):instance&&"object"==typeof instance&&Array.isArray(schema.required)&&schema.required.forEach(function(n){void 0===instance[n]&&result.addError({name:"required",argument:n,message:"requires property "+JSON.stringify(n)})}),result},validators.pattern=function(instance,schema,options,ctx){if("string"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.match(schema.pattern)||result.addError({name:"pattern",argument:schema.pattern,message:"does not match pattern "+JSON.stringify(schema.pattern)}),result},validators.format=function(instance,schema,options,ctx){var result=new ValidatorResult(instance,schema,options,ctx);return result.disableFormat||helpers.isFormat(instance,schema.format,this)||result.addError({name:"format",argument:schema.format,message:"does not conform to the "+JSON.stringify(schema.format)+" format"}),result},validators.minLength=function(instance,schema,options,ctx){if("string"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.length>=schema.minLength||result.addError({name:"minLength",argument:schema.minLength,message:"does not meet minimum length of "+schema.minLength}),result},validators.maxLength=function(instance,schema,options,ctx){if("string"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.length<=schema.maxLength||result.addError({name:"maxLength",argument:schema.maxLength,message:"does not meet maximum length of "+schema.maxLength}),result},validators.minItems=function(instance,schema,options,ctx){if(!(instance instanceof Array))return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.length>=schema.minItems||result.addError({name:"minItems",argument:schema.minItems,message:"does not meet minimum length of "+schema.minItems}),result},validators.maxItems=function(instance,schema,options,ctx){if(!(instance instanceof Array))return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.length<=schema.maxItems||result.addError({name:"maxItems",argument:schema.maxItems,message:"does not meet maximum length of "+schema.maxItems}),result},validators.uniqueItems=function(instance,schema,options,ctx){function testArrays(v,i,a){for(var j=i+1;j<a.length;j++)if(helpers.deepCompareStrict(v,a[j]))return!1;return!0}var result=new ValidatorResult(instance,schema,options,ctx);return instance instanceof Array?(instance.every(testArrays)||result.addError({name:"uniqueItems",message:"contains duplicate item"}),result):result},validators.uniqueItems=function(instance,schema,options,ctx){if(!(instance instanceof Array))return null;var result=new ValidatorResult(instance,schema,options,ctx);return instance.every(testArrays)||result.addError({name:"uniqueItems",message:"contains duplicate item"}),result},validators.dependencies=function(instance,schema,options,ctx){if(!instance||"object"!=typeof instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);for(var property in schema.dependencies)if(void 0!==instance[property]){var dep=schema.dependencies[property],childContext=ctx.makeChild(dep,property);if("string"==typeof dep&&(dep=[dep]),dep instanceof Array)dep.forEach(function(prop){void 0===instance[prop]&&result.addError({name:"dependencies",argument:childContext.propertyPath,message:"property "+prop+" not found, required by "+childContext.propertyPath})});else{var res=this.validateSchema(instance,dep,options,childContext);result.instance!==res.instance&&(result.instance=res.instance),res&&res.errors.length&&(result.addError({name:"dependencies",argument:childContext.propertyPath,message:"does not meet dependency required by "+childContext.propertyPath}),result.importErrors(res))}}return result},validators.enum=function(instance,schema,options,ctx){if(!(schema.enum instanceof Array))throw new SchemaError("enum expects an array",schema);if(void 0===instance)return null;var result=new ValidatorResult(instance,schema,options,ctx);return schema.enum.some(helpers.deepCompareStrict.bind(null,instance))||result.addError({name:"enum",argument:schema.enum,message:"is not one of enum values: "+schema.enum.join(",")}),result},validators.not=validators.disallow=function(instance,schema,options,ctx){var self=this;if(void 0===instance)return null;var result=new ValidatorResult(instance,schema,options,ctx),notTypes=schema.not||schema.disallow;return notTypes?(notTypes instanceof Array||(notTypes=[notTypes]),notTypes.forEach(function(type){if(self.testType(instance,schema,options,ctx,type)){var schemaId=type&&type.id&&"<"+type.id+">"||type;result.addError({name:"not",argument:schemaId,message:"is of prohibited type "+schemaId})}}),result):null},module.exports=attribute},{"./helpers":2}],2:[function(require,module,exports){"use strict";var uri=require("url"),ValidationError=exports.ValidationError=function(message,instance,schema,propertyPath,name,argument){propertyPath&&(this.property=propertyPath),message&&(this.message=message),schema&&(schema.id?this.schema=schema.id:this.schema=schema),instance&&(this.instance=instance),this.name=name,this.argument=argument,this.stack=this.toString()};ValidationError.prototype.toString=function(){return this.property+" "+this.message};var ValidatorResult=exports.ValidatorResult=function(instance,schema,options,ctx){this.instance=instance,this.schema=schema,this.propertyPath=ctx.propertyPath,this.errors=[],this.throwError=options&&options.throwError,this.disableFormat=options&&options.disableFormat===!0};ValidatorResult.prototype.addError=function(detail){var err;if("string"==typeof detail)err=new ValidationError(detail,this.instance,this.schema,this.propertyPath);else{if(!detail)throw new Error("Missing error detail");if(!detail.message)throw new Error("Missing error message");if(!detail.name)throw new Error("Missing validator type");err=new ValidationError(detail.message,this.instance,this.schema,this.propertyPath,detail.name,detail.argument)}if(this.throwError)throw err;return this.errors.push(err),err},ValidatorResult.prototype.importErrors=function(res){if("string"==typeof res||res&&res.validatorType)this.addError(res);else if(res&&res.errors){var errs=this.errors;res.errors.forEach(function(v){errs.push(v)})}},ValidatorResult.prototype.toString=function(res){return this.errors.map(function(v,i){return i+": "+v.toString()+"\n"}).join("")},Object.defineProperty(ValidatorResult.prototype,"valid",{get:function(){return!this.errors.length}});var SchemaError=exports.SchemaError=function SchemaError(msg,schema){this.message=msg,this.schema=schema,Error.call(this,msg),Error.captureStackTrace(this,SchemaError)};SchemaError.prototype=Object.create(Error.prototype,{constructor:{value:SchemaError,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var SchemaContext=exports.SchemaContext=function(schema,options,propertyPath,base,schemas){this.schema=schema,this.options=options,this.propertyPath=propertyPath,this.base=base,this.schemas=schemas};SchemaContext.prototype.resolve=function(target){return uri.resolve(this.base,target)},SchemaContext.prototype.makeChild=function(schema,propertyName){var propertyPath=void 0===propertyName?this.propertyPath:this.propertyPath+makeSuffix(propertyName),base=uri.resolve(this.base,schema.id||""),ctx=new SchemaContext(schema,this.options,propertyPath,base,Object.create(this.schemas));return schema.id&&!ctx.schemas[base]&&(ctx.schemas[base]=schema),ctx};var FORMAT_REGEXPS=exports.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(input){return"string"==typeof input&&parseFloat(input)===parseInt(input,10)&&!isNaN(input)},regex:function(input){var result=!0;try{new RegExp(input)}catch(e){result=!1}return result},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};FORMAT_REGEXPS.regexp=FORMAT_REGEXPS.regex,FORMAT_REGEXPS.pattern=FORMAT_REGEXPS.regex,FORMAT_REGEXPS.ipv4=FORMAT_REGEXPS["ip-address"],exports.isFormat=function(input,format,validator){if("string"==typeof input&&void 0!==FORMAT_REGEXPS[format]){if(FORMAT_REGEXPS[format]instanceof RegExp)return FORMAT_REGEXPS[format].test(input);if("function"==typeof FORMAT_REGEXPS[format])return FORMAT_REGEXPS[format](input)}else if(validator&&validator.customFormats&&"function"==typeof validator.customFormats[format])return validator.customFormats[format](input);return!0};var makeSuffix=exports.makeSuffix=function(key){return key=key.toString(),key.match(/[.\s\[\]]/)||key.match(/^[\d]/)?key.match(/^\d+$/)?"["+key+"]":"["+JSON.stringify(key)+"]":"."+key};exports.deepCompareStrict=function deepCompareStrict(a,b){if(typeof a!=typeof b)return!1;if(a instanceof Array)return b instanceof Array&&(a.length===b.length&&a.every(function(v,i){return deepCompareStrict(a[i],b[i])}));if("object"==typeof a){if(!a||!b)return a===b;var aKeys=Object.keys(a),bKeys=Object.keys(b);return aKeys.length===bKeys.length&&aKeys.every(function(v){return deepCompareStrict(a[v],b[v])})}return a===b},module.exports.deepMerge=function deepMerge(target,src){var array=Array.isArray(src),dst=array&&[]||{};return array?(target=target||[],dst=dst.concat(target),src.forEach(function(e,i){"object"==typeof e?dst[i]=deepMerge(target[i],e):target.indexOf(e)===-1&&dst.push(e)})):(target&&"object"==typeof target&&Object.keys(target).forEach(function(key){dst[key]=target[key]}),Object.keys(src).forEach(function(key){"object"==typeof src[key]&&src[key]&&target[key]?dst[key]=deepMerge(target[key],src[key]):dst[key]=src[key]})),dst},exports.objectGetPath=function(o,s){for(var k,parts=s.split("/").slice(1);"string"==typeof(k=parts.shift());){var n=decodeURIComponent(k.replace(/~0/,"~").replace(/~1/g,"/"));if(!(n in o))return;o=o[n]}return o},exports.encodePath=function(a){return a.map(function(v){return"/"+encodeURIComponent(v).replace(/~/g,"%7E")}).join("")}},{url:9}],3:[function(require,module,exports){"use strict";var Validator=module.exports.Validator=require("./validator");module.exports.ValidatorResult=require("./helpers").ValidatorResult,module.exports.ValidationError=require("./helpers").ValidationError,module.exports.SchemaError=require("./helpers").SchemaError,module.exports.validate=function(instance,schema,options){var v=new Validator;return v.validate(instance,schema,options)}},{"./helpers":2,"./validator":4}],4:[function(require,module,exports){"use strict";var urilib=require("url"),attribute=require("./attribute"),helpers=require("./helpers"),ValidatorResult=helpers.ValidatorResult,SchemaError=helpers.SchemaError,SchemaContext=helpers.SchemaContext,Validator=function Validator(){this.customFormats=Object.create(Validator.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(types),this.attributes=Object.create(attribute.validators)};Validator.prototype.customFormats={},Validator.prototype.schemas=null,Validator.prototype.types=null,Validator.prototype.attributes=null,Validator.prototype.unresolvedRefs=null,Validator.prototype.addSchema=function(schema,uri){if(!schema)return null;var ourUri=uri||schema.id;return this.addSubSchema(ourUri,schema),ourUri&&(this.schemas[ourUri]=schema),this.schemas[ourUri]},Validator.prototype.addSubSchema=function(baseuri,schema){if(schema&&"object"==typeof schema){if(schema.$ref){var resolvedUri=urilib.resolve(baseuri,schema.$ref);return void(void 0===this.schemas[resolvedUri]&&(this.schemas[resolvedUri]=null,this.unresolvedRefs.push(resolvedUri)))}var ourUri=schema.id&&urilib.resolve(baseuri,schema.id),ourBase=ourUri||baseuri;if(ourUri){if(this.schemas[ourUri]){if(!helpers.deepCompareStrict(this.schemas[ourUri],schema))throw new Error("Schema <"+schema+"> already exists with different definition");return this.schemas[ourUri]}this.schemas[ourUri]=schema;var documentUri=ourUri.replace(/^([^#]*)#$/,"$1");this.schemas[documentUri]=schema}return this.addSubSchemaArray(ourBase,schema.items instanceof Array?schema.items:[schema.items]),this.addSubSchemaArray(ourBase,schema.extends instanceof Array?schema.extends:[schema.extends]),this.addSubSchema(ourBase,schema.additionalItems),this.addSubSchemaObject(ourBase,schema.properties),this.addSubSchema(ourBase,schema.additionalProperties),this.addSubSchemaObject(ourBase,schema.definitions),this.addSubSchemaObject(ourBase,schema.patternProperties),this.addSubSchemaObject(ourBase,schema.dependencies),this.addSubSchemaArray(ourBase,schema.disallow),this.addSubSchemaArray(ourBase,schema.allOf),this.addSubSchemaArray(ourBase,schema.anyOf),this.addSubSchemaArray(ourBase,schema.oneOf),this.addSubSchema(ourBase,schema.not),this.schemas[ourUri]}},Validator.prototype.addSubSchemaArray=function(baseuri,schemas){if(schemas instanceof Array)for(var i=0;i<schemas.length;i++)this.addSubSchema(baseuri,schemas[i])},Validator.prototype.addSubSchemaObject=function(baseuri,schemas){if(schemas&&"object"==typeof schemas)for(var p in schemas)this.addSubSchema(baseuri,schemas[p])},Validator.prototype.setSchemas=function(schemas){this.schemas=schemas},Validator.prototype.getSchema=function(urn){return this.schemas[urn]},Validator.prototype.validate=function(instance,schema,options,ctx){options||(options={});var propertyName=options.propertyName||"instance",base=urilib.resolve(options.base||"/",schema.id||"");if(ctx||(ctx=new SchemaContext(schema,options,propertyName,base,Object.create(this.schemas)),ctx.schemas[base]||(ctx.schemas[base]=schema)),schema){var result=this.validateSchema(instance,schema,options,ctx);if(!result)throw new Error("Result undefined");return result}throw new SchemaError("no schema specified",schema)},Validator.prototype.validateSchema=function(instance,schema,options,ctx){function shouldResolve(schema){var ref="string"==typeof schema?schema:schema.$ref;return"string"==typeof ref&&ref}function resolve(schema,ctx){var ref;return(ref=shouldResolve(schema))?self.resolve(schema,ref,ctx).subschema:schema}var self=this,result=new ValidatorResult(instance,schema,options,ctx);if(!schema)throw new Error("schema is undefined");schema.extends&&(schema.extends instanceof Array?schema.extends.forEach(function(s){schema=helpers.deepMerge(schema,resolve(s,ctx))}):schema=helpers.deepMerge(schema,resolve(schema.extends,ctx)));var switchSchema;if(switchSchema=shouldResolve(schema)){var resolved=this.resolve(schema,switchSchema,ctx),subctx=new SchemaContext(resolved.subschema,options,ctx.propertyPath,resolved.switchSchema,ctx.schemas);return this.validateSchema(instance,resolved.subschema,options,subctx)}var skipAttributes=options&&options.skipAttributes||[];for(var key in schema)if(!attribute.ignoreProperties[key]&&skipAttributes.indexOf(key)<0){var validatorErr=null,validator=self.attributes[key];if(validator)validatorErr=validator.call(self,instance,schema,options,ctx);else if(options.allowUnknownAttributes===!1)throw new SchemaError("Unsupported attribute: "+key,schema);validatorErr&&result.importErrors(validatorErr)}if("function"==typeof options.rewrite){var value=options.rewrite.call(this,instance,schema,options,ctx);result.instance=value}return result},Validator.prototype.resolve=function(schema,switchSchema,ctx){if(switchSchema=ctx.resolve(switchSchema),ctx.schemas[switchSchema])return{subschema:ctx.schemas[switchSchema],switchSchema:switchSchema};var parsed=urilib.parse(switchSchema),fragment=parsed&&parsed.hash,document=fragment&&fragment.length&&switchSchema.substr(0,switchSchema.length-fragment.length);if(!document||!ctx.schemas[document])throw new SchemaError("no such schema <"+switchSchema+">",schema);var subschema=helpers.objectGetPath(ctx.schemas[document],fragment.substr(1));if(void 0===subschema)throw new SchemaError("no such schema "+fragment+" located in <"+document+">",schema);return{subschema:subschema,switchSchema:switchSchema}},Validator.prototype.testType=function(instance,schema,options,ctx,type){if("function"==typeof this.types[type])return this.types[type].call(this,instance);if(type&&"object"==typeof type){var res=this.validateSchema(instance,type,options,ctx);return void 0===res||!(res&&res.errors.length)}return!0};var types=Validator.prototype.types={};types.string=function(instance){return"string"==typeof instance},types.number=function(instance){return"number"==typeof instance&&isFinite(instance)},types.integer=function(instance){return"number"==typeof instance&&instance%1===0},types.boolean=function(instance){return"boolean"==typeof instance},types.array=function(instance){return instance instanceof Array},types.null=function(instance){return null===instance},types.date=function(instance){return instance instanceof Date},types.any=function(instance){return!0},types.object=function(instance){return instance&&"object"==typeof instance&&!(instance instanceof Array)&&!(instance instanceof Date)},module.exports=Validator},{"./attribute":1,"./helpers":2,url:9}],5:[function(require,module,exports){(function(global){!function(root){function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(digit<t);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(q<t);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string;
})}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],7:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],8:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":6,"./encode":7}],9:[function(require,module,exports){"use strict";function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return util.isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}var punycode=require("punycode"),util=require("./util");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/"),url=uSplit.join(splitter);var rest=url;if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],parseQueryString?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;atSign=hostEnd===-1?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)!==-1){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."===last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":10,punycode:5,querystring:8}],10:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],11:[function(require,module,exports){module.exports={name:"jet-api",version:"2.1.11",scripts:{lint:"jshint src","build:dev":"browserify src/main.js > dist/JET.js","build:production":"browserify src/main.js | uglifyjs --compress > dist/JET.min.js",build:"npm run build:dev && npm run build:production",test:"nyc --reporter=html babel-node spec/babel_spec_runner.js","test:watch":"npm test -- -watch","test:bundle":"browserify spec/spec/specs.js -o spec/browser/test.bundle.js -t [ babelify --presets [ es2015 ] ]"},main:"src/main.js",repository:{type:"git",url:"https://github.com/thomsonreuters/jet-api.git"},bugs:{url:"https://github.com/thomsonreuters/jet-api/issues"},homepage:"https://github.com/thomsonreuters/jet-api#readme",dependencies:{jsonschema:"^1.0.2","prepend-file-cli":"^1.0.2"},devDependencies:{"babel-cli":"6.11.4","babel-plugin-istanbul":"1.0.3","babel-preset-es2015":"6.9.0",babelify:"7.3.0",browserify:"^13.0.0","cross-env":"2.0.0",ghooks:"1.3.2",istanbul:"0.4.4",jasmine:"2.4.1","jasmine-jquery":"2.1.1",jquery:"3.1.0",jsdom:"8.2.0",nyc:"7.1.0",sinon:"1.17.5","uglify-js":"^2.6.1",jshint:"*"},config:{ghooks:{"pre-commit":"npm t"}},nyc:{exclude:["spec/setup.js","spec/babel_spec_runner.js","spec/mocks/**/*.js","spec/spec/**/*spec.js"],sourceMap:!1,instrument:!1}}},{}],12:[function(require,module,exports){function getLinkContextForNode(targetNode){var res={};if(targetNode){var n=targetNode;for("IMG"==n.nodeName&&(res.imgUrl=n.src);n;){if("A"===n.nodeName){res.aUrl=n.href;break}var parent=n.parentNode;if(!parent||n==parent||parent.documentElement)break;n=parent}}return res}function getNodeForAnEvent(ev){var n=null;return ev||(ev=window.event),ev?(ev.target?n=ev.target:ev.srcElement&&(n=ev.srcElement),3==n.nodeType&&(n=n.parentNode),n):null}function _modifyCommandBarItems(items){Array.isArray(items)&&items.forEach(function(item,j){if(item.type&&!item.item){item.item=item.type,item.type=void 0;try{delete item.type}catch(e){}}if("Header"===item.item&&item.caption&&items[j+1]&&(items[j+1].beginGroup=!0,items[j+1].groupName=item.caption),item.captionType){item.type=item.captionType,item.captionType=void 0;try{delete item.captionType}catch(e){}}item.items&&_modifyCommandBarItems(item.items)})}function _modifyCommandBars(bars){if(bars)return bars.commandBars&&Array.isArray(bars.commandBars)&&(bars=bars.commandBars),Array.isArray(bars)&&bars.forEach(function(commandBar){commandBar.items&&_modifyCommandBarItems(commandBar.items)}),bars}function _updateCommandBars(data){logger.debug("JET.updateCommandBars called. Data: ",data),data.commandBars=_modifyCommandBars(data.commandBars),_router.processEvent({name:"onUpdateCommandBars",data:data})}function _onCommand(data){var h=_commandHandlers[data.id];h&&("string"==typeof h&&(h=util.eval(h)),h.call(window,null!=data.value?data.value:data))}function _addItemHandlers(it){if(it.item)switch(it.item){case"SplitButton":case"Menu":if(it.items)for(var len=it.items.length,i=0;i<len;i++)_addItemHandlers(it.items[i]);return;case"Print":return void(it.handler&&_addCommandHandler("PRINT",it.handler))}"undefined"!=typeof it.id&&it.handler&&_addCommandHandler(it.id,it.handler)}function _addBarHandlers(commandBars){if(commandBars)for(var numCommandBars=commandBars.length,i=0;i<numCommandBars;i++){var b=commandBars[i];if(b.items)for(var numItems=b.items.length,n=0;n<numItems;n++)_addItemHandlers(b.items[n])}}function _addEventCommandHandlers(data){switch(data.name){case"onContextMenu":data.data.menu&&_addBarHandlers(data.data.menu);break;case"onToast":_addItemHandlers(data.data);break;case"onLoad":data.data.toolbar&&_addBarHandlers(data.data.toolbar),data.data.serviceMenu&&_addBarHandlers(data.data.serviceMenu),data.data.apptitlebar&&_addBarHandlers(data.data.apptitlebar),data.data.appmenu&&_addBarHandlers(data.data.appmenu);break;case"onUpdateCommandBars":data.data.commandBars&&_addBarHandlers(data.data.commandBars)}return data}function isFlagOn(value,flag){return 0!==(value&flag)}function formatNavigationFlag(prop){var flag=prop.NavigationSupport.value;"string"!=typeof flag&&(isFlagOn(flag,api.NavigationSupport.CanPublishContext)||isFlagOn(flag,api.NavigationSupport.CanReceiveContext)||(flag|=128),prop.NavigationSupport.value=flag.toString())}var util=require("./Util"),mixin=require("./shared/mixin"),_JET=require("./JETCore"),logger=require("./UtilLogger"),_router=require("./router"),mergeProps=require("./shared/mergeprops"),_properties={};if(_router._peoverride)_router.processEvent(msg);else{var oldPE=_router.processEvent.bind(_router);_router.processEvent=function(msg){_addEventCommandHandlers(msg),oldPE(msg)},_router._peoverride=!0}var _commandHandlers={},_addCommandHandler=function(id,handler){_commandHandlers[id]=handler};_JET.onLoad(function(){_router.addEventHandler("onCommand",_onCommand,!0)});var containerEvents=["onSendObject","onPropertyChange","onCommand","onDragEnter","onDragOver","onDragLeave","onDrop","onPaste","onActivate","onDeactivate"];util.addHandlers(containerEvents,_JET);var api={updateAppMenu:function(menu){if(menu){var data={commandBarType:"AppMenu",commandBars:menu};_updateCommandBars(data)}},contextChange:function(data){_router.processEvent({name:"onContextChange",data:data})},getProperty:function(name){return _properties[name]},setProperties:function(properties){_properties=mergeProps(_properties,properties),_router.processEvent({name:"onPropertyChange",data:_properties})},NavigationSupport:{ShowRelatedTradeInToolbar:1,ShowRelatedTradeOnRightClick:2,CanPublishContext:32,CanReceiveContext:64},contextMenu:function(data){var res=getLinkContextForNode(getNodeForAnEvent());if(mixin(data,res),logger.debug("JET.contextMenu called. Data: ",data),data.menu&&(data.menu=_modifyCommandBars(data.menu)),data.mouse&&data.mouse.type){var temp=data.mouse;delete data.mouse,data.mouse={screenX:temp.screenX,screenY:temp.screenY,clientX:temp.clientX,clientY:temp.clientY}}_router.processEvent({name:"onContextMenu",data:data}),util.stopBubbling()},copyToClipboard:function(data){logger.debug("JET.copyToClipboard called. Data: ",data),_router.processEvent({name:"onCopyToClipboard",data:data})},toast:function(data){_router.processEvent({name:"onToast",data:data})},screenshot:function(){logger.debug("JET.screenshot called."),_JET.navigate({url:"lac://TR.Screenshot.PROGID",name:"Eikon Library Object"}),util.stopBubbling()},sendByMail:function(data){logger.debug("JET.sendByMail called."),_router.processEvent({name:"onSendByMail",data:data})}};mixin(_JET,api);var fullAPIUtil={getComponentDescription:function(){var data={properties:util.properties(),entities:_JET.Context||[]};return formatNavigationFlag(data.properties),util.commandline()&&(data.toolbar={commandBars:[{items:[{item:"Search"}]}]}),util.apptitlebar()&&(data.apptitlebar=_modifyCommandBars(util.apptitlebar())),util.appmenu()&&(data.appmenu=_modifyCommandBars(util.appmenu())),data}};mixin(util,fullAPIUtil)},{"./JETCore":17,"./Util":24,"./UtilLogger":25,"./router":28,"./shared/mergeprops":35,"./shared/mixin":36}],13:[function(require,module,exports){function update(){boundObjects.persistdata=hash,_JET.Archive.save()}function getPersistCpURL(url,cpUrl){return url.replace(/^(?:[^:\/\\?#]+:(?=\/\/))?(?:\/\/)?(?:[^:\/\\?#]*(?::[^\/\\?#]*)?)?/,"cpurl://"+cpUrl)}function bindArchiveToJET(){_JET.Archive=_JET.Archive||[];for(var archiveKeys=Object.keys(archiveFunctions),numberKeys=archiveKeys.length,i=0;i<numberKeys;i++){var key=archiveKeys[i];_JET.Archive[key]=archiveFunctions[key]}}function onPersistData(persist){var data;if(logger.debug("Received archive data: ",persist),persist&&persist.data&&(data=Array.isArray(persist.data)?persist.data:persist.data.data),data){loaded=!0,_JET.Archive=[];for(var i=0;i<data.length;++i){var _item=data[i];if("_archiveHash"===_item.name)try{hash=JSON.parse(_item.value)}catch(e){logger.debug("Received bad _archiveHash data: ",_item.value)}else _JET.Archive.push({name:_item.name,value:_item.value})}}}function _getArchiveData(){var dfd,promise=new Promise(function(resolve,reject){dfd={resolve:resolve}}),url=_JET.PersistURL,data={data:[]};if(null!==url&&(data.url=url),_JET.SAP&&(data.cpurl=getPersistCpURL(url,JET.SAP)),_JET.Archive){data.data=[];for(var i=0;i<_JET.Archive.length;++i)data.data.push({name:_JET.Archive[i].name,value:_JET.Archive[i].value});null!=hash&&data.data.push({name:"_archiveHash",value:JSON.stringify(hash)})}return null!=_JET.Context&&_JET.Context.length>0?_router.toContainerAsync("ContextData",JET.Context).then(function(value){data.data.push({name:"context",value:value}),boundObjects.persistdata=data,dfd.resolve(data)}):(boundObjects.persistdata=data,dfd.resolve(data)),promise}var _JET=require("./JETCore"),_router=require("./router"),logger=require("./UtilLogger"),util=require("./Util"),mixin=require("./shared/mixin"),loaded=!1,hash={},boundObjects=require("./shared/boundObjects"),archiveFunctions={put:function(name,value){return hash[name]!==value&&(hash[name]=value,update(),!0)},get:function(name,def){return hash[name]?hash[name]:def},clear:function(){hash={},update()},getAllKeys:function(){return Object.keys(hash)},save:function(){_getArchiveData().then(function(data){_router.processEvent({name:"persistdata",data:data})})}};mixin(util,{onPersistData:function(persist){return onPersistData(persist),bindArchiveToJET(),loaded},getArchiveData:function(){return _getArchiveData()}})},{"./JETCore":17,"./Util":24,"./UtilLogger":25,"./router":28,"./shared/boundObjects":30,"./shared/mixin":36}],14:[function(require,module,exports){function getCoords(e){var sx=e.screenX,sy=e.screenY;return{clientX:e.clientX,clientY:e.clientY,screenX:sx,screenY:sy,eventData:sx+","+sy}}function finishDrag(dropAborted,e){var coords=getCoords(e);dropAborted&&_dndState==DATA_AVAILABLE&&(fireJETDragLeave(),callDragLeave(coords)),dropAborted?callCancelDragDrop(coords):callResetDragDrop(coords),_dropData=null,_dndState=NO_DRAG_STARTED}function _getDataRequestId(){var id=_dataRequestId;return _dataRequestId++,id}function getDropData(callback,errorCallback,coords){_router.getContainerData({name:"getDropData",xmlData:coords.eventData}).then(function(data){"undefined"!=typeof data&&null!=data?callback(data):errorCallback("null or undefined received")})}function fireJETDragOver(dropData,coords){_callEvent({name:"onDragOver",data:{x:coords.clientX,y:coords.clientY,e:coords.srcEvent,dropData:dropData}})}function fireJETDragLeave(dropData){_callEvent({name:"onDragLeave",data:null})}function fireJETContextChanged(dropData){_callEvent({name:"onContextChange",data:dropData})}function fireJETDrop(dropData,coords){dropData.mouse=coords,_callEvent({name:"onDrop",data:dropData}),fireJETContextChanged(dropData)}function fireJETDragEnter(dropData,coords){dropData.mouse=coords,_callEvent({name:"onDragEnter",data:dropData})}function _callEvent(obj){_router.callEventHandler(obj)}function callResetDragDrop(){null!=window.externalHost&&_router.getContainerData({name:"resetDragDrop",xmlData:null,async:function(){}})}function callDragEnter(coords){null!=window.externalHost&&_router.getContainerData({name:"windowDragEnter",xmlData:coords.eventData,async:function(){}})}function callDragLeave(coords){null!=window.externalHost&&_router.getContainerData({name:"windowDragLeave",xmlData:coords.eventData,async:function(){}})}function callCancelDragDrop(coords){null!=window.externalHost&&_router.getContainerData({name:"cancelDragDrop",xmlData:coords.eventData,async:function(){}})}var util=require("./Util"),_JET=require("./JETCore"),logger=require("./UtilLogger"),_router=require("./router"),mixin=require("./shared/mixin"),_dataRequestId=0,_enterLeaveCounter=0,NO_DRAG_STARTED="noDragStarted",DATA_AVAILABLE="dataAvailable",NO_VALID_DRAG_DATA="noValidDragData",PENDING="pending",GET_DROP_DATA_FAILED="getDropDataFailed",_dropData=null,_dndState=NO_DRAG_STARTED,_dropEffect="copy",_dndManager={setDropData:function(data){_dropData=data,_dndState=DATA_AVAILABLE}};try{window.top.setDragData=function(data){_router.getFromContainer("fromTransferData",data).then(function(dropData){_dropData=dropData.data,_dndState=DATA_AVAILABLE})}}catch(e){logger.warn("setDragData cannot access top frame.")}util.addEvent(document,"dragstart",function(e){_dndState!==DATA_AVAILABLE&&(_dndState=NO_VALID_DRAG_DATA)}),util.addEvent(document,"dragenter",function(e){if(_dndState===NO_DRAG_STARTED){_dndState=PENDING;var dataRequestID=_getDataRequestId(),requestID=dataRequestID,coords=getCoords(e);null!==window.externalHost&&getDropData(function(data){_dndState===PENDING&&requestID===dataRequestID&&(_dndManager.setDropData(data),_dndState=DATA_AVAILABLE,fireJETDragEnter(data,coords))},function(error){logger.error("Error getting drop data: "+error),_dndState=GET_DROP_DATA_FAILED},getCoords(e))}else _dndState===DATA_AVAILABLE&&0===_enterLeaveCounter&&fireJETDragEnter(_dropData,getCoords(e));0===_enterLeaveCounter&&callDragEnter(getCoords(e)),_enterLeaveCounter++,_dndState===DATA_AVAILABLE&&(e.dataTransfer||e.fakeDataTransfer)?(e.dataTransfer||e.fakeDataTransfer).dropEffect=_dropEffect:(e.dataTransfer||e.fakeDataTransfer)&&((e.dataTransfer||e.fakeDataTransfer).dropEffect="none"),e.preventDefault()}),util.addEvent(document,"dragleave",function(e){_enterLeaveCounter--,0===_enterLeaveCounter&&finishDrag(!0,e),e.preventDefault()}),util.addEvent(document,"drop",function(e){_enterLeaveCounter=0,_dndState===DATA_AVAILABLE&&fireJETDrop(_dropData,getCoords(e)),finishDrag(!1,e),e.preventDefault()}),util.addEvent(document,"dragover",function(e){_dndState===DATA_AVAILABLE?((e.dataTransfer||e.fakeDataTransfer)&&((e.dataTransfer||e.fakeDataTransfer).dropEffect=_dropEffect),fireJETDragOver(_dropData,getCoords(e))):(e.dataTransfer||e.fakeDataTransfer).dropEffect="none",e.preventDefault()});var api={dragStart:function(data){_dndManager&&_dndManager.setDropData(data);var context=null;return data.entities&&data.entities.length&&(context=data.entities),null!=context&&(_router.processEvent({name:"onContextDragStart",data:context}),util.stopBubbling(),!0)}};mixin(_JET,api)},{"./JETCore":17,"./Util":24,"./UtilLogger":25,"./router":28,"./shared/mixin":36}],15:[function(require,module,exports){var _loggingSource,_router=require("./router"),_JET=require("./JETCore"),mixin=require("./shared/mixin"),logger=require("./UtilLogger"),names=["debug","information","warning","high","critical"];_loggingSource=_JET.ID||"",names.forEach(function(name){_JET[name]=function(message){_JET.log({messages:[{severity:name,text:message,source:_loggingSource}]})}});var api={log:function(data){logger.debug("JET.log called. Data: ",data),_router.processEvent({name:"onLog",data:data})},loggingOptions:function(logLevel,alogger){logger.setLogOptions(logLevel)},loggingSource:function(source){_loggingSource=source}};mixin(_JET,api)},{"./JETCore":17,"./UtilLogger":25,"./router":28,"./shared/mixin":36}],16:[function(require,module,exports){function isString(it){return"string"==typeof it||it instanceof String}function getDataSync(name){return _router.getContainerData({name:name,xmlData:""})}function getDataSyncDeferred(name){return dfd(function(){return getDataSync(name)},function(data){return data})}function extractActiveEntity(entities){if(!(void 0===entities||void 0===entities.length||entities.length<=0)){if(1===entities.length&&isString(entities[0].RIC))return entities[0];var firstRicEntity;for(var k in entities){var entity=entities[k];if(isString(entity.RIC)&&(void 0===firstRicEntity&&(firstRicEntity=entity),entity.hasOwnProperty("NavigationNS")))return entity}return firstRicEntity}}var dfd=require("./shared/deferred"),_router=require("./router"),logger=require("./UtilLogger"),mixin=require("./shared/mixin"),JET=require("./JETCore"),api={getProperties:function(){return logger.debug("JET.getProperties called."),getDataSyncDeferred("description")},getSavedState:function(){return logger.debug("JET.getSavedState called."),getDataSyncDeferred("persistdata")},getPasteData:function(){return logger.debug("JET.getPasteData called."),getDataSyncDeferred("getPasteData")},isActive:function(){return logger.debug("JET.isActive called."),getDataSyncDeferred("isActive")},hasFocus:function(){return logger.debug("JET.hasFocus called."),getDataSyncDeferred("hasFocus")},getActiveSymbol:function(){return logger.debug("JET.getActiveSymbol called."),dfd(this.getActiveContext,extractActiveEntity,function(data){console.log("could not retrieve ActiveSymbol")})},getActiveContext:function(){return logger.debug("JET.getActiveContext called."),getDataSyncDeferred("ActiveSymbol")},getClipboardData:function(){return logger.debug("JET.getClipboardData called."),getDataSyncDeferred("ClipboardData")}};mixin(JET,api)},{"./JETCore":17,"./UtilLogger":25,"./router":28,"./shared/deferred":33,"./shared/mixin":36}],17:[function(require,module,exports){function _init(initObj){if(logger.setLogLevel(initObj.LogLevel),initObj.required&&!JET.Plugins.loaded(initObj.required)&&!JET.Plugins.loaded())return logger.info("required plugins loading..."),
void setTimeout(function(){JET.init(initObj)},10);properties.init(initObj),mixin(JET,initObj),JET.LoadFailed=!1;var topUrl=null;useTop&&_top&&(topUrl=top.location.href),JET.PersistURL=JET.PersistURL||topUrl,router.addEventHandler("Publish",_publishHandler);var registerPromise=router.JETRegisterRequest(initObj.ID);return registerPromise.then(function(data){if(!data.subApp){loadBindContainerInformation(data,JET),_container.getDataQueue.forEach(function(msg){router.getContainerData(msg)}),_container.processEventQueue.forEach(function(msg){router.processEvent(msg)}),logger.debug("JET successfully registered with container finished"),logger.debug("Requesting archive data from container."),_archiveLoaded=getPersistData(data);var descData=util.getComponentDescription(JET);logger.debug("Sending onLoad. Data:",descData),router.processEvent({name:"onLoad",data:descData}),initializeLoadJET(JET),router._setRegisterData(data)}},function(error){_failMessage='Could not register JET. Error: "'+error+'"',console.log(_failMessage),loadFailed(JET,_failMessage)})}function _publishHandler(eventObj){var res=router.callSubscriptions(eventObj,[eventObj.data,eventObj.channel]);return"undefined"!=typeof res&&res}function loadBindContainerInformation(data,jet){if(data.containerDescription){var userAgent=data.containerDescription.userAgent;if(void 0!==userAgent){var g=/EIKON([0-9]*)\.([0-9]*)\.([0-9]*),/i.exec(userAgent);g&&4==g.length&&(data.containerDescription.major=parseInt(g[1]),data.containerDescription.minor=parseInt(g[2]),data.containerDescription.build=parseInt(g[3]))}jet.ContainerDescription=data.containerDescription}data.ContainerType&&(jet.ContainerType=data.ContainerType)}function getPersistData(data){return data=data||{persistData:{}},data=data.persistData,util.onPersistData(data)}function initializeLoadJET(jet){jet.Loaded=!0,jet.Initialized=!0,jet.Context&&jet.Context.length&&jet.contextChange(jet.Context),window.onunload=function(){jet.unload()},_onLoadedCallbacks.run(window,_archiveLoaded),_onLoadedCallbacks=callbacksExecutor()}function loadFailed(jet,message){jet.Loaded=!1,jet.Initialized=!1,jet.LoadFailed=!0,_onLoadFailedCallbacks.run(window,message),_onLoadFailedCallbacks=callbacksExecutor()}function waitForEikonNowReady(){if("EikonNow"in window&&window.EikonNow.isEnabled()){var dfd={},promise=new Promise(function(resolve,reject){dfd.resolve=resolve,dfd.reject=reject});return window.EikonNow.ready(function(){dfd.resolve()}),promise}return!1}function jetinit(initObj){var container,_jet=JET,containerType=_jet.containerType();if("desktop"===containerType)try{useTop=!0,container=window.top}catch(ex){useTop=!1,container=window}else container=window;if(!container.__initACS__)throw new Error("JET could not find the container");var initACS=container.__initACS__;new Promise(function(resolve,reject){initACS(resolve,reject)}).then(function(response){if(mm=new MessageManager({sameWindowStrategy:"desktop"!==containerType}),router.setBus(mm),mm.registerNamespace(router),response.register)router.ACShandshake().then(function(){_init(initObj)}),_topLevel=!0;else{var rejectCount=0,askForRegData=function(){setTimeout(function(){router.ACSpollForInitData().then(function(data){logger.debug("JET loading a sub app.");var persistdata;try{data=data[0],persistdata=data.persistData}catch(e){data={},persistdata=""}loadBindContainerInformation(data,_jet),_archiveLoaded=getPersistData(persistdata),router.addEventHandler("Publish",_publishHandler),initializeLoadJET(_jet)},function(reject){rejectCount<10?setTimeout(function(){askForRegData(),rejectCount++},40):(_failMessage='Failed to load JET as a sub app. Error: "'+reject+'"',logger.debug(_failMessage),loadFailed(_jet,_failMessage))},40)})};askForRegData()}})}var JET,mm,api,version=require("../package.json").version,router=require("./router"),MessageManager=require("./MessageManager"),mixin=require("./shared/mixin"),logger=require("./UtilLogger"),util=require("./Util"),properties=require("./JETProperties"),dataProviders=require("./JETDataProviders"),_container=require("./stubs/container"),_top=require("./shared/_top"),useTop=!1,callbacksExecutor=require("./shared/callbacksExecutor"),_topLevel=!1,_onLoadedCallbacks=callbacksExecutor(),_onLoadFailedCallbacks=callbacksExecutor(),_onUnloadCallbacks=callbacksExecutor(),_archiveLoaded=!1,_failMessage="";logger.setLogOptions(2),window.JET=function(){var _dataProviders=dataProviders(window.JET);return api={getDataProviders:function(){return _dataProviders},containerType:function(){var ua=window.navigator.userAgent;return ua.indexOf("EikonViewer")>-1?"desktop":ua.indexOf("Mobile")>-1||ua.indexOf("Mobi/")>-1||ua.indexOf("Tablet")>-1?"mobile":"web"},extend:function(version,namespace,declaration){if(!JET[namespace])try{JET[namespace]=declaration(util)}catch(e){logger.warn("Fail to load plugin: "+namespace+" due to "+e.toString())}},navigate:function(data){router.processEvent({name:"onNavigate",data:data})},onLoad:function(handler,plugins){var newHandler=plugins?function(){JET.Plugins.loaded(plugins)?handler.call(window,_archiveLoaded):JET.onPluginLoaded(function(){JET.Plugins.loaded(plugins)&&handler.call(window,_archiveLoaded)})}:handler;JET.Loaded?newHandler.call(window,_archiveLoaded):_onLoadedCallbacks.push(newHandler)},onLoadFailed:function(handler){JET.LoadFailed?handler.call(window,_failMessage):_onLoadFailedCallbacks.push(handler)},onUnload:function(onUnloadCallback){_onUnloadCallbacks.push(onUnloadCallback)},onContextChange:function(onContextChangeCallback){router.addEventHandler("onContextChange",onContextChangeCallback,!0)},unload:function(){if(_onUnloadCallbacks.run(),_onUnloadCallbacks=callbacksExecutor(),_onLoadedCallbacks=callbacksExecutor(),_onLoadFailedCallbacks=callbacksExecutor(),_topLevel)try{_top=useTop?top:window,_top.__unRegisterACS__(),delete _top.__initACS__}catch(e){}mm&&mm.unload(),router.setBus(void 0),mm=void 0,JET.Loaded=!1,JET.Initialized=!1,JET.ContainerDescription=void 0,JET.Context=void 0},init:function(initObj){initObj=initObj||{};var shouldWaitForEikonNowReady=waitForEikonNowReady();shouldWaitForEikonNowReady?shouldWaitForEikonNowReady.then(function(){jetinit(initObj)}):jetinit(initObj)}}}(),JET=window.JET,JET.version=version,module.exports=JET},{"../package.json":11,"./JETDataProviders":18,"./JETProperties":20,"./MessageManager":22,"./Util":24,"./UtilLogger":25,"./router":28,"./shared/_top":29,"./shared/callbacksExecutor":32,"./shared/mixin":36,"./stubs/container":38}],18:[function(require,module,exports){var boundObjects=require("./shared/boundObjects"),util=require("./Util"),dataProviders=function(JET){return{properties:function(){return boundObjects.properties},description:function(){return util.getComponentDescription(JET)},persistdata:function(){return util.getArchiveData()},helpurl:function(){return boundObjects.helpurl},context:function(){return boundObjects.context},inputowner:function(){var inputowner=JET.IsInputOwner?"component":"container";return boundObjects.inputowner=inputowner,inputowner}}};module.exports=dataProviders},{"./Util":24,"./shared/boundObjects":30}],19:[function(require,module,exports){var util=require("./util"),JET=require("./JETCore"),mixin=require("./shared/mixin"),loaded=[],inflight=[],core=[],registrationQueue=[],onPluginLoadedCallbacks=[],window=window||{},api={plugin:function(plug){var r="function"==typeof plug?plug(util):{};if(r.name){var name=r.name.toLowerCase();if(loaded.indexOf(name)!==-1)throw new Error("Tried to a load a plugin with the same name: ",r.name);loaded.push(name),inflight=inflight.filter(function(d){return d.toLowerCase()!==name})}mixin(util,r.util),mixin(JET,r.api),r.register&&registrationQueue.push(r.register),r.containerEvents&&util.addHandlers(r.containerEvents,JET),onPluginLoadedCallbacks.forEach(function(f){f.call(window,r.name)})},onPluginLoaded:function(handler){onPluginLoadedCallbacks.push(handler)},Plugins:{loaded:function(list){return list?list.every(function(p){return loaded.indexOf(p.toLowerCase())>-1}):loaded},inflight:function(core_plugin){return!(!inflight||inflight.length<1)&&(!core_plugin||inflight.some(function(d){if(core.indexOf(d)>-1)return!0}))},require:function(name,src,defer){if(!defer&&name&&core.indexOf(name)===-1&&core.push(name),this.loaded([name])||inflight.indexOf(name)>-1);else{inflight.push(name);var scriptElement=document.createElement("script");scriptElement.setAttribute("src",src),document.querySelector("head").appendChild(scriptElement)}}}};mixin(JET,api)},{"./JETCore":17,"./shared/mixin":36,"./util":40}],20:[function(require,module,exports){var boundObjects=require("./shared/boundObjects"),commandline=!1,apptitlebar=null,props=["Title","Summary","HelpURL"],api={init:function(initObj){var _properties={};commandline=initObj.commandline||!!initObj.Toolbar,this.commandline=commandline,this.apptitlebar=initObj.AppTitleBar||apptitlebar,this.appmenu=initObj.AppMenu||{},_properties.NavigationSupport={value:initObj.NavigationSupport||"98",type:"xs:string",access:"rw"},props.forEach(function(p){_properties[p]={value:initObj[p]||"",type:"xs:string",access:"ro"},initObj[p]&&delete initObj[p]}),_properties.HelpURL&&(boundObjects.helpurl=_properties.HelpURL),initObj.Context&&(boundObjects.context=initObj.Context),boundObjects.properties=_properties}};module.exports=api},{"./shared/boundObjects":30}],21:[function(require,module,exports){var JET=require("./JETCore"),router=require("./router"),mixin=require("./shared/mixin"),jsonschema=require("jsonschema"),handlerId=1010,pubsub={send:function(target,channel,data){2===arguments.length?router.publishWithPipeTarget(arguments[0],arguments[1]):router.publishWithPipeTarget(channel,data,target)},subscription:function(target,channel,data){var subId=handlerId++ +Date.now();if(2===arguments.length){var channelArg=arguments[0],dataArg=arguments[1];return{id:subId,onUpdate:function(handler){return router.subscriptionWithPipeTarget({channel:channelArg,context:dataArg,handler:handler,pipe:!0}),this}}}var guid=JET.ContainerDescription.GUID,subscribeChannel=channel+"/"+guid+":"+subId,errorChannel=subscribeChannel+"/error";return{id:subId,onUpdate:function(handler){return router.subscriptionWithPipeTarget({channel:subscribeChannel,data:data,target:target,handler:handler,requestSubscribeWithPipe:{channel:channel+"/onSubscribe",pipe:!0}}),this},onError:function(handler){return router.subscriptionWithPipeTarget({channel:errorChannel,data:data,target:target,handler:handler}),this},unsubscribe:function(){router.unsubscribeChannel({channel:subscribeChannel}),router.unsubscribeChannel({channel:errorChannel});var subData={channel:subscribeChannel,target:target,data:data};return router.processEvent({name:"Publish",data:JSON.stringify(subData),target:target,channel:channel+"/onUnsubscribe",pipe:!0}),this}}},service:function(channel){var requestChannel=channel+"/onRequest",subsribeChannel=channel+"/onSubscribe",unSubsribeChannel=channel+"/onUnsubscribe",onsub=router.subscriptionWithPipeTarget({channel:subsribeChannel}),onunsub=router.subscriptionWithPipeTarget({channel:unSubsribeChannel}),onreq=router.subscriptionWithPipeTarget({channel:requestChannel}),service={subscriptions:{},onSubscribe:function(handler){var original=handler,that=this;return handler=function(){var sub=JSON.parse(arguments[0]);return that.subscriptions[sub.channel]=sub,original.apply(this,arguments)},router.addSubscriptionHandler({channel:subsribeChannel,handler:handler}),service},onRequest:function(handler){return router.addSubscriptionHandler({channel:requestChannel,handler:handler}),service},onUnsubscribe:function(handler){return router.addSubscriptionHandler({channel:unSubsribeChannel,handler:handler}),service},unsubscribe:function(){onsub.unsubscribe(),onunsub.unsubscribe(),onreq.unsubscribe()}};return service},request:function(target,channel,data){var dfd,guid=JET.ContainerDescription.GUID,subId=handlerId++ +Date.now(),subscribeChannel=channel+"/"+guid+":"+subId,errorChannel=subscribeChannel+"/error",prom=new Promise(function(res,rej){dfd={resolve:res,reject:rej}});router.subscriptionWithPipeTarget({channel:subscribeChannel,data:data,target:target,handler:function(value){router.unsubscribeChannel({channel:subscribeChannel}),router.unsubscribeChannel({channel:errorChannel}),dfd.resolve(value)},requestSubscribeWithPipe:{channel:channel+"/onRequest",pipe:!0}}),router.subscriptionWithPipeTarget({channel:errorChannel,target:target,handler:function(value){router.unsubscribeChannel({channel:subscribeChannel}),router.unsubscribeChannel({channel:errorChannel}),dfd.reject(value)}});return prom},Data:function(serviceName){var dfd,prom=new Promise(function(res,rej){dfd={resolve:res,reject:rej}});return JET.request("!data","/data-service/info",{name:serviceName}).then(function(desc){var descriptor=JSON.parse(desc);if(descriptor.error&&dfd.reject(descriptor.error),descriptor){var service={};descriptor.verbs&&descriptor.verbs.indexOf("request")>-1&&(service.request=function(requestObj){var isValidRequest=JET.validateJSON(requestObj,descriptor.schema);if(isValidRequest)return JET.request("!data","/"+serviceName,requestObj);throw new Error("Invalid request")}),descriptor.verbs&&descriptor.verbs.indexOf("subscribe")>-1&&(service.subscribe=function(requestObj){var isValidRequest=JET.validateJSON(requestObj,descriptor.schema);if(isValidRequest)return JET.subscription("!data","/"+serviceName,requestObj);throw new Error("Invalid request")}),dfd.resolve(service)}else dfd.reject("Description object not returned")},function(err){dfd.reject("couldn't access "+serviceName+" service")}),prom},validateJSON:function(request,schema){var Validator=jsonschema.Validator,v=new Validator,result=v.validate(request,schema);return!(result.errors&&result.errors.length>0)||(console.log(result.errors),!1)},publish:function(channel,data){router.publish(channel,data)},subscribe:function(channel,handler,context){var options={channel:channel,handler:handler,context:context};return router.subscribe(options)},unsubscribeAll:function(){router.unsubscribeAll()},unsubscribe:function(channelName){return router.unsubscribeChannel({channel:channelName})}};mixin(JET,pubsub)},{"./JETCore":17,"./router":28,"./shared/mixin":36,jsonschema:3}],22:[function(require,module,exports){function messageForJET(message){return!(!message||!message.lastIndexOf||0!==message.lastIndexOf("acs--jet--",0))}function MessageManager(options){if(options=options||{},this._promiseIndex=1,this._promises={},this._deferreds={},this._sanitaryFunctions=void 0,this.name=Math.floor(1e3*Math.random())+1+"j_mm",options.sameWindowStrategy){if(this.sameWindowStrategy=!0,window.__JETMessageShim__=this._messageHandlerSameWindow.bind(this),!window.__ACSMessageShim__)throw new Error("Could not find ACSMessageShim.");this.__ACSMessageShim__=window.__ACSMessageShim__,this.sendMessage=function(where,options){options=options||{},this.__ACSMessageShim__(where,options)},this.sendPromise=function(where,options){options=options||{};var promiseIndex=this._makePromise();return options.promiseIndex=promiseIndex,this.sendMessage(where,options),this._promises[promiseIndex]},this.removeListener=function(){}}else this.init(),this.sendMessage=function(where,options){options=options||{},where.postMessage(this._makeMessage(options),"*")},this.sendPromise=function(where,options){options=options||{};var promiseIndex=this._makePromise();return options.promiseIndex=promiseIndex,this.sendMessage(where,options),this._promises[promiseIndex]}}var _top=require("./shared/_top"),frame=_top?top:window,_parsers=["jet:msg"];MessageManager.prototype={unload:function(){this.removeListener(),this.__namespaces__=[]},init:function(){return this.source=window,this.boundOnMessage=this._messageHandler.bind(this),this.source.addEventListener?this.source.addEventListener("message",this.boundOnMessage,!1):this.source.attachEvent&&this.source.attachEvent("onmessage",this.boundOnMessage,!1),this},removeListener:function(){this.source.removeEventListener?this.source.removeEventListener("message",this.boundOnMessage,!1):this.source.detachEvent&&this.source.detachEvent("onmessage",this.boundOnMessage,!1)},_makePromise:function(){var context=this,index=this._promiseIndex++ +"_"+this.name,promise=new Promise(function(resolve,reject){context._deferreds[index]={resolve:resolve,reject:reject}});return this._promises[index]=promise,index},_getPromise:function(id){return this._deferreds[id]},_cleanPromise:function(id,type){this._deferreds[id]=type,this._promises[id]=type},_resolvePromise:function(id,params){var promise=this._getPromise(id);if(promise&&promise.resolve)if(promise.resolve(params),this.sameWindowStrategy){var self=this;setTimeout(function(){self._cleanPromise(id,"resolved")},1e3)}else this._cleanPromise(id,"resolved")},_rejectPromise:function(id,params){var promise=this._getPromise(id);promise&&promise.reject&&(promise.reject(params),this._cleanPromise(id,"rejected"))},_parseData:function(dataString){var numberOfParsers=_parsers.length;if(numberOfParsers>0)for(var i=0;i<numberOfParsers;i++){var parserString=_parsers[i];if("[object String]"==Object.prototype.toString.call(dataString)){if(dataString.match(parserString)){dataString=dataString.replace(parserString,"");try{return JSON.parse(dataString)}catch(e){}}}else if("object"==typeof dataString)return dataString}else try{return JSON.parse(dataString)}catch(e){}},addSanitizedFuncName:function(funcNames){this._sanitaryFunctions?this._sanitaryFunctions=new RegExp(this._sanitaryFunctions.source+"|"+funcNames):this._sanitaryFunctions=new RegExp(funcNames)},_isSanitaryFunction:function(funcName){return this._sanitaryFunctions?funcName.match(this._sanitaryFunctions)?funcName:void 0:funcName},_makeMessage:function(options){options=options||{};var key="";return options.parseKey&&(key+=options.parseKey),key+JSON.stringify({params:options.params,promiseIndex:options.promiseIndex,funcName:options.funcName,parseKey:options.parseKey,attachSource:options.attachSource,senderId:"acs--jet--"+this.name,name:this.name})},_messageHandler:function(event){var data=(event.source,event.origin,this._parseData(event.data));data.targetId?messageForJET(data.senderId)&&this._handleEikonMessage(data):data.funcName&&this._handleMessage(event.source,data)},_messageHandlerSameWindow:function(window,data){data&&!data.targetId?data.funcName&&this._handleMessage(window,data):this._handleEikonMessage(data)},_handleMessage:function(source,data){function returnPromise(options){options=options||{},options.parseKey="jet:msg",context.sendMessage(source,options)}var context=this,funcName=data.funcName,params=data.params,promiseIndex=data.promiseIndex,attachSource=data.attachSource;switch(funcName){case"handshake":this.sendMessage(source,{promiseIndex:promiseIndex,parseKey:data.parseKey,funcName:"replyHandshake"});break;case"replyHandshake":this._resolvePromise(promiseIndex,!0);break;case"replyPromiseResolve":this._resolvePromise(promiseIndex,params);break;case"replyPromiseReject":this._rejectPromise(promiseIndex,params);break;case"getRegisterData":this.registerData&&promiseIndex?this.sendMessage(source,{promiseIndex:promiseIndex,parseKey:data.parseKey,funcName:"replyRegisterData",params:this.registerData}):this.sendMessage(source,{promiseIndex:promiseIndex,parseKey:data.parseKey,funcName:"replyRegisterData"});break;case"replyRegisterData":params?this._resolvePromise(promiseIndex,params):this._rejectPromise(promiseIndex,!1);break;default:if(attachSource&&params.unshift(source),promiseIndex){var fn,scope;scope=this.__getFunc(funcName),scope&&(fn=scope[funcName],"function"==typeof fn&&fn.apply(scope,params).then(function(resolvedData){var options={funcName:"replyPromiseResolve",source:source,params:resolvedData,promiseIndex:promiseIndex};returnPromise(options)},function(error){var options={funcName:"replyPromiseReject",params:[error],promiseIndex:promiseIndex};returnPromise(options)}))}else scope=this.__getFunc(funcName),scope&&(fn=scope[funcName],"function"==typeof fn&&fn.apply(scope,params))}},_handleEikonMessage:function(data){this.sendMessage(frame,{parseKey:"jet:msg",params:[data.data],attachSource:!0,funcName:"_onProcessEventWithSource"})},__namespaces__:[],registerNamespace:function(namespace){this.__namespaces__.push(namespace)},__getFunc:function(funcName){for(var scope=void 0,namespaces=this.__namespaces__,numberNamespaces=namespaces.length,i=0;i<numberNamespaces;i++){var namespace=namespaces[i];if(namespace[funcName]){scope=namespace;break}}return scope}},module.exports=MessageManager},{"./shared/_top":29}],23:[function(require,module,exports){var logger=require("./UtilLogger"),_JET=require("./JETCore"),dfd=require("./shared/deferred"),router=require("./router");_JET.plugin(function(){return{name:"UserInfo",api:{getUserInfo:function(){return logger.debug("JET.getUserInfo called."),dfd(function(){return router.getContainerData({name:"UserInfo"})},function(data){return data},function(data){console.log("could not get userinfo")})}}}})},{"./JETCore":17,"./UtilLogger":25,"./router":28,"./shared/deferred":33}],24:[function(require,module,exports){var _vents=[],logger=require("./UtilLogger"),mixin=require("./shared/mixin"),router=require("./router"),properties=require("./JETProperties"),boundObjects=require("./shared/boundObjects"),toolbarStub=require("./stubs/commandBar"),api={addEvent:function(source,key,func){return _vents.push({source:source,key:key,func:func}),source.addEventListener&&source.addEventListener(key,func),source.attachEvent&&source.attachEvent("on"+key,func),func},stopBubbling:function(){var event;window.event?event=window.event:window.frames[0]&&window.frames[0].event&&(event=window.frames[0].event),event&&(event.preventDefault?(event.preventDefault(),event.stopPropagation()):(event.cancelBubble=!0,event.returnValue=!1))},addOnUnload:function(func){this.addEvent(window,"unload",function(){func.apply(window,arguments)})},addHandlers:function(events,api){events.forEach(function(e){api[e]=function(handler){return router.addEventHandler(e,handler,!0)}})},getComponentDescription:function(jet){var data={properties:this.properties(),entities:jet.Context||[]};return this.commandline()&&(data.toolbar=toolbarStub),boundObjects.description=data,data},properties:function(props){if(!props)return boundObjects.properties},commandline:function(cmd){if(!arguments.length)return properties.commandline},apptitlebar:function(cmd){if(!arguments.length)return properties.apptitlebar},appmenu:function(appm){if(!appm)return properties.appmenu}};module.exports=api,mixin(api,logger)},{"./JETProperties":20,"./UtilLogger":25,"./router":28,"./shared/boundObjects":30,"./shared/mixin":36,"./stubs/commandBar":37}],25:[function(require,module,exports){function log(){for(var params=[],len=arguments.length,i=0;i<len;i++)params.push(arguments[i]);params=params.map(function(p){return"function"==typeof p?p():"string"==typeof p?p:p?Array.isArray(p)?p.join(" "):JSON.stringify(p):""}),console.log(params.join(""))}function setLog(level){return _logLevel<=level?function(){log.apply(this,arguments)}:function(){}}var _logLevel,router=require("./router"),logLevels=["trace","debug","info","warn","error"],api={setLogLevel:function(logName){var level=logLevels.indexOf(logName);level===-1&&(level=2),this.setLogOptions(level),router.setLogLevel(level)},setLogOptions:function(logLevel){_logLevel=void 0===logLevel||null===logLevel?10:logLevel,this.trace=setLog(0),this.debug=setLog(1),this.info=setLog(2),this.warn=setLog(3),this.error=setLog(4)}};module.exports=api},{"./router":28}],26:[function(require,module,exports){var _JET=require("./JETCore"),router=require("./router");_JET.plugin(function(){function _extractWindowId(){_JET.ContainerDescription&&_JET.ContainerDescription.windowInfo&&_JET.ContainerDescription.windowInfo.windowId&&(_windowId=_JET.ContainerDescription.windowInfo.windowId)}function _onLinkChannelEvents(message){if(_windowId&&message.data){var data=message.data;if(data.windowId&&data.windowId===_windowId&&data.event)switch(data.event){case"linked":_onLinkedCallbacks.forEach(function(callback){callback.call(window,{groupId:data.groupId})});break;case"unlinked":_onUnlinkedCallbacks.forEach(function(callback){callback.call(window,{groupId:data.groupId})});break;case"linkStatus":data.isLinked&&_onLinkedCallbacks.forEach(function(callback){callback.call(window,{groupId:data.groupId})})}}}function _subscribeAppContainerEvents(){_JET.subscribe("/container_events",_onAppContainerEvent)}function _onAppContainerEvent(message){if(message=JSON.parse(message),message&&message.name)switch(message.name){case"LinkChannel":_onLinkChannelEvents(message)}}function _getLinkChannelStatus(){if(_windowId){var message={name:"LinkChannel",data:{action:"GetLinkStatus",windowId:_windowId}};_JET.publish("/container_actions",JSON.stringify(message))}}_JET.onLoad(function(){_extractWindowId(),_subscribeAppContainerEvents(),_getLinkChannelStatus()});var _windowId=null,_onLinkedCallbacks=[],_onUnlinkedCallbacks=[];return{name:"Window",api:{resizeTo:function(width,height,inner){inner===!0&&(width+=window.outerWidth-window.innerWidth,height+=window.outerHeight-window.innerHeight),router.processEvent({name:"onResize",data:{width:width,height:height}})},resizeBy:function(wDelta,hDelta){router.processEvent({name:"onResize",data:{width:window.outerWidth+wDelta,height:window.outerHeight+hDelta}})},hide:function(){router.processEvent({name:"onHide",data:null})},show:function(){router.processEvent({name:"onShow",data:null})},flash:function(data){router.processEvent({name:"onFlash",xmlData:data})},stopFlash:function(){router.processEvent({name:"onStopFlash",data:null})},onLinked:function(handler){_onLinkedCallbacks.push(handler)},onUnlinked:function(handler){_onUnlinkedCallbacks.push(handler)}}}})},{"./JETCore":17,"./router":28}],27:[function(require,module,exports){require("./Util");var JET=require("./JETCore");require("./JETPlugins"),require("./JETPubSub"),require("./FullAPI"),require("./FullAPIViewRequests"),require("./FullAPIArchive"),require("./FullAPILogger"),require("./FullAPIDragAndDrop"),require("./UserInfo"),require("./Window"),window._hasJET&&window._hasJET(),module.exports=JET},{"./FullAPI":12,"./FullAPIArchive":13,"./FullAPIDragAndDrop":14,"./FullAPILogger":15,"./FullAPIViewRequests":16,"./JETCore":17,"./JETPlugins":19,"./JETPubSub":21,"./UserInfo":23,"./Util":24,"./Window":26}],28:[function(require,module,exports){function fireQueuedMessages(router){queuedSyncMessages.length&&queuedSyncMessages.forEach(function(msg){router.sendMessageToBus(msg)}),queuedSyncMessages=[]}var __bus,__handlerId=0,__channelHandlers={},__eventHandlers={},registrationConfiguration=require("./stubs/registerConfiguration"),parseKey="jet:msg",queuedSyncMessages=[],ready=!1,useTop=require("./shared/_top"),frame=useTop?top:window;module.exports={sendMessageToBus:function(data){__bus?__bus.sendMessage(frame,data):queuedSyncMessages.push(data)},sendPromiseToBus:function(data){return __bus.sendPromise(frame,data)},setBus:function(bus){__bus=bus},getChannelHandlers:function(){return __channelHandlers},getChannelHandler:function(channel){return channel?__channelHandlers[channel]:void 0},getEventHandlers:function(){return __eventHandlers},getEventHandler:function(name){return name?__eventHandlers[name]:void 0},_addHandlerHelper:function(options,bucket){var subscription,subscriptionId=__handlerId++,ctx=this,key=options.name||options.channel;return subscription={id:subscriptionId,handler:options.handler,context:options.context||window,unsubscribe:function(){return ctx.__unsubscribe({id:subscriptionId,key:key},bucket)}},this.__addSubscriptionToBucket(options,subscription,bucket),{unsubscribe:function(){return ctx.__unsubscribe({id:subscriptionId,key:key},bucket)}}},__addSubscriptionToBucket:function(options,subscription,bucket){var subscriptions,key=options.name||options.channel;if(key)return subscriptions=bucket[key],subscriptions?subscriptions.push(subscription):bucket[key]=[subscription],bucket[key]},ACShandshake:function(){return this.sendPromiseToBus({parseKey:"jet:msg",funcName:"handshake",params:[]})},ACSpollForInitData:function(){return this.sendPromiseToBus({funcName:"getRegisterData",parseKey:"jet:msg",attachSource:!0})},JETRegisterRequest:function(id){var data=registrationConfiguration(id);return this.sendPromiseToBus({parseKey:"jet:msg",funcName:"_registerJETApp",params:[data]})},_setRegisterData:function(data,jet){ready=!0,fireQueuedMessages(this),data.subApp?this.ACSpollForInitData():this.sendMessageToBus({funcName:"setRegisterData",parseKey:"jet:msg",params:[data]})},callEventHandler:function(event){return this.doEvent(event)},doEvent:function(event){var data;data="string"==typeof event?JSON.parse(event):event;var subscriptions,response,name=data.name;if(name&&(subscriptions=this.getEventHandler(name)),subscriptions&&subscriptions.forEach(function(subscription){subscription.handler&&(response=subscription.handler.apply(subscription.context,[data]))}),response)return response},addEventHandler:function(name,handler,context){this._addHandlerHelper({name:name,handler:context?function(event){return handler.call(window,event.data)}:handler,context:void 0},__eventHandlers)},processEvent:function(data){this.sendMessageToBus({parseKey:"jet:msg",funcName:"_processEvent",params:[data],attachSource:!0})},publish:function(channel,data){var publish={channel:channel,data:data};this.sendMessageToBus({parseKey:"jet:msg",funcName:"_publish",params:[publish]})},publishWithPipeTarget:function(channel,data,target){var publish={channel:channel,data:data,pipe:!0};target&&(publish.target=target),this.sendMessageToBus({parseKey:"jet:msg",funcName:"_publishWithPipeTarget",params:[publish]})},_emitSubscribe:function(options){var subscription={type:options.type,data:{channel:options.channel}};this.sendMessageToBus({parseKey:"jet:msg",funcName:"_subscribe",params:[subscription.data],attachSource:!0})},subscribe:function(options){options=options||{};var subscription=this.addSubscriptionHandler(options);return this._emitSubscribe(options),subscription},_emitSubscribeWithPipeTarget:function(options){this.sendMessageToBus({parseKey:"jet:msg",funcName:"_subscribeWithPipeTarget",params:[options],attachSource:!0})},subscriptionWithPipeTarget:function(options){options=options||{};var subscription=this.addSubscriptionHandler(options);return this._emitSubscribeWithPipeTarget(options),subscription},addSubscriptionHandler:function(options){return this._addHandlerHelper(options,this.getChannelHandlers())},_callSubscriptionsHelper:function(channel,args){var subscriptions,response;if(channel&&(subscriptions=this.getChannelHandlers(channel)),subscriptions&&subscriptions.forEach(function(subscription){var handler=subscription.handler;handler&&(response=handler.apply(subscription.context,args))}),response)return response},unsubscribeChannel:function(options){return options=options||{},options.key=options.channel,this.__unsubscribe(options,this.getChannelHandlers())},__unsubscribe:function(options,handlers){options=options||{};var key=options.key,subscriptions=handlers,subscribers=subscriptions[key],id=options.id;if(subscribers){for(var numSubscribers=subscribers.length,i=0;i<numSubscribers;i++){var subscriber=subscribers[i];if(subscriber.id===id){subscriptions[key]=null;break}subscriptions[key]=null}0===subscribers.length&&(this.__emitUnsubscribe({channel:key}),delete subscribers[key])}},__emitUnsubscribe:function(data){this.sendMessageToBus({parseKey:"jet:msg",funcName:"_unsubscribe",params:[data],attachSource:!0})},unsubscribeAll:function(){for(var subscriptions=this.getChannelHandlers(),keys=Object.keys(subscriptions),numKeys=keys.length,i=0;i<numKeys;i++){var subscribers=subscriptions[keys[i]];subscribers&&subscribers.forEach(function(subscriber){subscriber.unsubscribe&&subscriber.unsubscribe()}),null===subscriptions[keys[i]]&&(this.__emitUnsubscribe({channel:keys[i]}),delete subscriptions[keys[i]])}},callSubscriptions:function(event,args){var subscriptions,response,channel=event.channel;
if(channel&&(subscriptions=this.getChannelHandler(channel)),subscriptions&&subscriptions.forEach(function(subscription){var handler=subscription.handler;handler&&(response=handler.apply(subscription.context,args))}),response)return response},getContainerData:function(msg){return this.sendPromiseToBus({parseKey:"jet:msg",funcName:"getData",params:[msg]})},getFromContainer:function(event,data){return this.sendPromiseToBus({parseKey:"jet:msg",funcName:"_fromContainerAsync",params:[event,data]})},toContainerAsync:function(event,data){return this.sendPromiseToBus({parseKey:"jet:msg",funcName:"_toContainerAsync",params:[event,data]})},setLogLevel:function(level){this.sendMessageToBus({parseKey:"jet:msg",funcName:"_setLoggingLevel",params:[level]})},emitBoundProp:function(objectName,keyName,newValue){this.sendMessageToBus({parseKey:parseKey,funcName:"_setBoundedProp",params:[{name:objectName,key:keyName,value:newValue}]})}}},{"./shared/_top":29,"./stubs/registerConfiguration":39}],29:[function(require,module,exports){var useFrame=!1;try{window.top&&(useFrame=!0)}catch(e){useFrame=!1}module.exports=useFrame},{}],30:[function(require,module,exports){var boundProp=require("./boundProp"),DATAPROVIDERS="dataProviders",spyOn={};boundProp(spyOn,DATAPROVIDERS,"helpurl"),boundProp(spyOn,DATAPROVIDERS,"context"),boundProp(spyOn,DATAPROVIDERS,"properties"),boundProp(spyOn,DATAPROVIDERS,"persistdata"),boundProp(spyOn,DATAPROVIDERS,"description"),boundProp(spyOn,DATAPROVIDERS,"inputowner",!1),module.exports=spyOn},{"./boundProp":31}],31:[function(require,module,exports){var EmittedProp=require("./emittedProp"),router=require("../router");module.exports=function(obj,objectName,key,initialValue){return initialValue&&router.emitBoundProp(objectName,key,initialValue),EmittedProp(obj,key,objectName,function(name,key,value){router.emitBoundProp(name,key,value)})}},{"../router":28,"./emittedProp":34}],32:[function(require,module,exports){module.exports=function(scope){function reset(){funcs=[],size=0}var funcs=[],size=0;return{push:function(func){funcs[size]=func,size++},run:function(context){context=context||window;for(var args=Array.prototype.slice.call(arguments,1),i=0;i<size;i++){var func=funcs[i];func.call(context,args)}reset()}}}},{}],33:[function(require,module,exports){module.exports=function(async,cb,err){var dfd={},promise=new Promise(function(resolve,reject){dfd.resolve=resolve,dfd.reject=reject});return async().then(function(data){cb?dfd.resolve(cb(data)):dfd.resolve(data)},function(data){err?dfd.reject(err(data)):dfd.reject(data)}),promise}},{}],34:[function(require,module,exports){module.exports=function(obj,key,objectName,beforeSet){var value=void 0;Object.defineProperty(obj,key,{get:function(){return value},set:function(newValue){beforeSet(objectName,key,newValue),value=newValue}})}},{}],35:[function(require,module,exports){function toObj(props){if(!Array.isArray(props))return props;var r={};return props.forEach(function(p){p.name&&(r[p.name]=p)}),r}module.exports=function(a,b){a=toObj(a),b=toObj(b);for(var key in b){var prop=b[key],n=null,v=null;if(prop&&prop.name)n=prop.name,v=prop.text||prop.value||"";else for(var field in prop)if(prop.hasOwnProperty(field)){n=field,v=prop[field]||"";break}null!==n&&null!==v&&(a[n]={value:v,type:prop.type||"xs:string",access:"ro"===prop.access?"ro":"rw"})}return a}},{}],36:[function(require,module,exports){function mix(target,source){for(var propName in source)target[propName]=source[propName];return target}module.exports=function(obj){for(var i=1,l=arguments.length;i<l;i++)mix(obj||{},arguments[i]);return obj}},{}],37:[function(require,module,exports){module.exports={commandBars:[{items:[{item:"Search"}]}]}},{}],38:[function(require,module,exports){module.exports={getDataQueue:[],processEventQueue:[],getData:function(msg){this.getDataQueue.push(msg)},processEvent:function(msg){this.processEventQueue.push(msg)}}},{}],39:[function(require,module,exports){module.exports=function(id){return{domain:"EikonJET",xmlData:{version:"3.3.0",id:id},method:"registerWithCCF"}}},{}],40:[function(require,module,exports){arguments[4][24][0].apply(exports,arguments)},{"./JETProperties":20,"./UtilLogger":25,"./router":28,"./shared/boundObjects":30,"./shared/mixin":36,"./stubs/commandBar":37,dup:24}]},{},[27]);
